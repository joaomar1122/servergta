import{r as c,u as b,j as s,m as U,S as j,a as t,I as Ce,L as a,F as M,C as H,b as re,P as w,g as J,c as ae,d as G,e as X,f as F,A as Z,h as ue,i as q,k as le,l as Ee,n as fe,o as ne,p as k,q as T,s as R,t as se,v as Pe,w as pe,x as Ae,y as Oe,z as Ne,B as Se,D as ie,E as he,G as Te,H as ce,M as oe,J as ge,K as ve,N as be,O as Le,Q as ye,R as Ie,T as ke,U as He,V as _e,W as we,X as Re}from"./index-a5f9a2c2.js";function Me(){const{View:o,Contact:E}=c.useContext(z),N=b(w.Settings),f=b(w.PhoneNumber),[r,C]=c.useState(null),[A,S]=o,[e,n]=E,u=b(R.APPS.PHONE.contacts),[v,m]=c.useState(!1),[d,g]=c.useState(!1);c.useEffect(()=>C(e.number),[]);const h=()=>{k("Phone",{action:"removeContact",number:e.number},!0).then(P=>{if(!P)return T("warning","Failed to remove contact");R.APPS.PHONE.contacts.set(u.filter(i=>i.number!==e.number)),n(null),S("Contacts")})},p=()=>{k("Phone",{action:"toggleBlock",number:e.number,blocked:!e.blocked},!0).then(P=>{if(P===void 0)return T("warning","Failed to toggle block");n({...e,blocked:!e.blocked}),R.APPS.PHONE.contacts.set(u.map(i=>i.number===e.number?{...i,blocked:!i.blocked}:i))})},$=()=>{k("Phone",{action:"toggleFavourite",number:e.number,favourite:!e.favourite},!0).then(P=>{if(!P)return T("warning","Failed to toggle favourite");n({...e,favourite:!e.favourite}),R.APPS.PHONE.contacts.set(u.map(i=>i.number===e.number?{...i,favourite:!i.favourite}:i))})},y=()=>{if(!e.number||e.number.length===0)return S("Contacts");e.number===f?(w.Settings.patch({name:e.firstname,avatar:e.avatar??N.avatar}),k("setPhoneName",e.firstname),k("setSettings",w.Settings.value),m(P=>!P),R.APPS.PHONE.contacts.set(u.map(P=>P.number===e.number?{...P,...e}:P))):(e.lastname=e.lastname??"",k("Phone",{action:"updateContact",data:{...e,oldNumber:r}},!0).then(P=>{if(!P)return T("warning","Failed to update contact");m(i=>!i),R.APPS.PHONE.contacts.set(u.map(i=>i.number===e.number?{...i,...e}:i)),C(e.number)}))},L=()=>{e&&H.PopUp.set({title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{k("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(P=>{P&&k("Messages",{action:"sendMessage",number:e.number,content:`<!SENT-LOCATION-X=${se(P.x,2)}Y=${se(P.y,2)}!>`,attachments:[]}).then(i=>{if(!i)return T("warning","something went wrong while sending location");Z.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&X(e.firstname,e.lastname),avatar:e.avatar},view:"messages"}})})})}}]})},x=c.useRef(!0);return c.useEffect(()=>{x.current&&x.current&&(C(e.number),x.current=!1,g(e.number===f))},[e]),s(U.div,{...j("right","contact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[v?t("span",{}):s("div",{className:"back",onClick:()=>{S(e.from),n(null)},children:[t(Ce,{}),a(`APPS.PHONE.${e.from.toUpperCase()}.TITLE`)]}),e.firstname&&!e.company&&t("span",{onClick:()=>{v?y():m(P=>!P)},children:v?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:v?t(M,{children:s("div",{className:"contact nohover",children:[s("div",{className:"user",onClick:()=>{H.ContextMenu.set({buttons:[{title:a("APPS.PHONE.CONTACTS.CHANGE_AVATAR"),cb:()=>{var P,i,l;H.Gallery.set({allowExternal:(l=(i=(P=re)==null?void 0:P.value)==null?void 0:i.AllowExternal)==null?void 0:l.Other,onSelect:I=>n({...e,avatar:I.src})})}},{title:a("APPS.PHONE.CONTACTS.REMOVE_AVATAR"),color:"red",cb:()=>{n({...e,avatar:null}),d&&w.Settings.set({...w.Settings.value,avatar:null})}}]})},children:[e.avatar||d&&N.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${e.avatar??N.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:J(e.firstname,e.lastname)}):t(ae,{}),t("span",{children:a("APPS.PHONE.EDIT")})]}),s("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(G,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),value:e.firstname,onChange:P=>n({...e,firstname:P.target.value}),maxLength:20})}),!d&&t("div",{className:"item input",children:t(G,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),value:e.lastname??"",onChange:P=>n({...e,lastname:P.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(G,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:e==null?void 0:e.number,maxLength:20,disabled:d,onChange:P=>{if(d)return;let i=P.target.value.slice(-1).charCodeAt(0);i>=48&&i<=57&&P.target.value.length<=10&&n({...e,number:P.target.value})}})})}),s("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(G,{className:"phone_number",type:"email",placeholder:a("APPS.PHONE.CONTACTS.EMAIL"),defaultValue:e==null?void 0:e.email,maxLength:20,onChange:P=>{d||P.target.value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&n({...e,email:P.target.value})}})}),t("div",{className:"item input",children:t(G,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.ADDRESS"),defaultValue:e==null?void 0:e.address,maxLength:20,onChange:P=>{d||n({...e,address:P.target.value})}})})]}),!d&&t("div",{className:"contact-info",children:t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:h}]})},children:a("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})}):t(M,{children:s("div",{className:"contact nohover details",children:[s("div",{className:"user",children:[e.avatar||d&&N.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${d?N.avatar:e.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:J(e.firstname,e.lastname)}):t(ae,{}),t("div",{className:"name",children:e.firstname?X(e.firstname,e.lastname):F(e.number)})]}),s("div",{className:"actions",children:[s("div",{className:"item","data-disabled":!!(d||e.company),onClick:()=>{Z.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&X(e.firstname,e.lastname),avatar:e.avatar,view:"messages"}}})},children:[t(ue,{}),a("APPS.PHONE.CONTACTS.MESSAGE")]}),s("div",{className:"item call","data-disabled":d,onClick:()=>{q({number:e.number,company:e.company,companylabel:e.company&&e.firstname})},children:[t(le,{}),a("APPS.PHONE.CONTACTS.CALL")]}),s("div",{className:"item","data-disabled":!!(d||e.company),onClick:()=>{q({number:e.number,company:e.company,companylabel:e.company&&e.firstname,videoCall:!0})},children:[t(Ee,{}),a("APPS.PHONE.CONTACTS.VIDEO")]}),s("div",{className:"item","data-disabled":!!e.company,onClick:()=>{e.company||H.Share.set({type:"contact",data:{number:e.number,firstname:e.firstname,lastname:e.lastname,avatar:e.avatar||d&&N.avatar,email:e.email,address:e.address}})},children:[t(fe,{}),a("APPS.PHONE.CONTACTS.SHARE")]})]}),!e.company&&s(M,{children:[t("div",{className:"contact-info",children:t("div",{className:"item",onClick:()=>{ne(e.number),H.PopUp.set({title:a("COMPONENTS.SHARE.COPY_POPUP.TITLE"),description:a("COMPONENTS.SHARE.COPY_POPUP.DESCRIPTION"),buttons:[{title:a("COMPONENTS.SHARE.COPY_POPUP.OK")}]})},children:t("div",{className:"value",children:F(e.number)})})}),(e.email||e.address)&&s("div",{className:"contact-info",children:[e.email&&s("div",{className:"item",onClick:()=>ne(e.email),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.EMAIL").toLowerCase()}),t("div",{className:"value",children:e.email})]}),e.address&&s("div",{className:"item",onClick:()=>ne(e.address),children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.ADDRESS").toLowerCase()}),t("div",{className:"value",children:e.address})]})]}),t("div",{className:"contact-info",children:e.firstname?t(M,{children:!d&&s(M,{children:[t("div",{className:"item",onClick:()=>L(),children:a("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),e.favourite?t("div",{className:"item red",onClick:()=>$(),children:a("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):t("div",{className:"item",onClick:()=>$(),children:a("APPS.PHONE.CONTACTS.ADD_FAVORITE")}),e.blocked?t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:F(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>p()}]})},children:a("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):t("div",{className:"item red",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:F(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{p()}}]})},children:a("APPS.PHONE.CONTACTS.BLOCK_CALLER")})]})}):t("div",{className:"item",onClick:()=>S("NewContact"),children:a("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})]})})})]})}function Ue(){const{View:o,viewContact:E}=c.useContext(z),N=b(w.Settings),[f,r]=o,C=b(w.PhoneNumber),A=b(R.APPS.PHONE.contacts),[S,e]=c.useState("");return s(U.div,{...j("left","contacts",.2),className:"animation-container",children:[s("div",{className:"contacts-header",children:[s("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.TITLE")}),t(Pe,{onClick:()=>r("NewContact")})]}),t(pe,{placeholder:a("SEARCH"),onChange:n=>e(n.target.value)})]}),t("div",{className:"content",children:s("div",{className:"contact-list",children:[t("div",{className:"letters",children:[...Array(26)].map((n,u)=>{let v=String.fromCharCode(u+65);return t("a",{children:v},u)})}),t("div",{className:"contact card",onClick:()=>E({firstname:N==null?void 0:N.name,number:C},"Contacts"),children:s("div",{className:"profile",children:[N.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${N.avatar})`}}):t("div",{className:"avatar",children:J(N==null?void 0:N.name)}),s("div",{className:"profile-info",children:[t("div",{className:"name",children:N==null?void 0:N.name}),t("div",{className:"info",children:a("APPS.PHONE.CONTACTS.MY_CARD")})]}),t(Ae,{})]})}),A&&s(M,{children:[Object.entries(A.filter(n=>X(n.firstname,n.lastname).toLowerCase().includes(S.toLowerCase())).sort((n,u)=>n.firstname.localeCompare(u.firstname)).reduce((n,u)=>{let v=u.firstname.charAt(0).toUpperCase();return n[v]||(n[v]=[]),n[v].push(u),n},{})).map(([n,u],v)=>s("div",{children:[t("div",{id:n,className:`divider ${v===0?"no-border":""}`,children:n}),t(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"contacts",children:u.map((m,d)=>s("div",{className:"contact item border",onClick:()=>E(m,"Contacts"),children:[m.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${m.avatar})`}}):t("div",{className:"avatar",children:J(m.firstname,m.lastname)}),s("div",{className:"details",children:[t("div",{className:"name",children:X(m.firstname,m.lastname)}),t("div",{className:"phone-number",children:F(m.number)})]})]},d))})]},v)),s("div",{className:"total-contacts",children:[A.length," ",a("APPS.PHONE.CONTACTS.TITLE")]})]})]})})]})}function Ve(){const{viewContact:o}=c.useContext(z),E=b(R.APPS.PHONE.contacts),[N,f]=c.useState(!1);return s(U.div,{...j("left","favourites",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.FAVOURITES.TITLE")}),t("span",{onClick:()=>f(!N),children:N?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:t("div",{className:"favourite",children:E.filter(r=>r.favourite||r.company).sort((r,C)=>r.company?-1:1).map((r,C)=>{let A=X(r.firstname,r.lastname);return s(U.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item",onClick:()=>{H.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:A}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:A}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{q({number:r.number,company:r.company,companylabel:r.firstname})}}]})},children:[s("div",{className:"user",children:[N&&!r.company&&t(Oe,{onClick:S=>{S.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:a("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{k("Phone",{action:"toggleFavourite",number:r.number,favourite:!1},!0).then(e=>{if(!e)return T("warning","Failed to remove favourite");R.APPS.PHONE.contacts.set(E.map(n=>n.number===r.number?{...n,favourite:!n.favourite}:n))})}}]})}}),r.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${r.avatar})`}}):t("div",{className:"avatar",children:J(r.firstname,r.lastname)}),s("div",{className:"info",children:[A,t("span",{children:F(r.number)})]})]}),t(Ne,{onClick:S=>{S.stopPropagation(),o(r,"Favourites")}})]},C)})})})]})}const V=[697,770,852,941],D=[1209,1336,1477,1633],de={1:[V[0],D[0]],2:[V[0],D[1]],3:[V[0],D[2]],4:[V[1],D[0]],5:[V[1],D[1]],6:[V[1],D[2]],7:[V[2],D[0]],8:[V[2],D[1]],9:[V[2],D[2]],"*":[V[3],D[0]],0:[V[3],D[1]],"#":[V[3],D[2]]},De=[{key:"1",letters:""},{key:"2",letters:"ABC"},{key:"3",letters:"DEF"},{key:"4",letters:"GHI"},{key:"5",letters:"JKL"},{key:"6",letters:"MNO"},{key:"7",letters:"PQRS"},{key:"8",letters:"TUV"},{key:"9",letters:"WXYZ"},{key:"*",letters:""},{key:"0",letters:"+"},{key:"#",letters:""}],ee={0:2.5,12:2,17:1.75};function Fe(){const{View:o,Contact:E,viewContact:N}=c.useContext(z),[f,r]=o,[C,A]=E,[S,e]=c.useState(null),[n,u]=c.useState(""),v=c.useRef(null),m=c.useRef([]),d=c.useRef(null),g=c.useRef(null),[h,p]=c.useState(2.5);c.useEffect(()=>{v.current||(v.current=new AudioContext)},[]),c.useEffect(()=>{document.addEventListener("keydown",x),document.addEventListener("keyup",P),n==="0"&&p(2.5);let i=0;for(let l=0;l<Object.keys(ee).length;l++)n.length>=parseInt(Object.keys(ee)[l])&&(i=ee[Object.keys(ee)[l]]);return p(i),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",P)}},[n]);const $=i=>{if(!v.current)return;const l=v.current,[I,O]=de[i],_="sine",K=l.createOscillator();K.frequency.value=I,K.type=_;const B=l.createOscillator();B.frequency.value=O,B.type=_;const Y=l.createGain();Y.gain.value=.2,K.connect(Y),B.connect(Y),Y.connect(l.destination),K.start(),B.start();const Q=setTimeout(()=>{y()},1500);m.current.push([K,B,Y,Q])},y=async()=>{m.current.forEach(([i,l,I,O])=>{clearTimeout(O);const _=v.current;_&&(clearTimeout(O),I.gain.exponentialRampToValueAtTime(1e-4,_.currentTime+.1),setTimeout(()=>{i.stop(),l.stop(),i.disconnect(),l.disconnect(),I.disconnect()},100))}),d.current=null,m.current=[]},L=async i=>{i=="delete"?u(l=>l.slice(0,-1)):i.match(/^[0-9]+$/)&&u(l=>l+i),de[i]&&(d.current&&await y(),d.current=i,$(i))},x=i=>{if(!d.current)if(i.key.match(/^[0-9]+$/))d.current=i.key,L(i.key);else switch(i.key){case"Backspace":L("delete");break;case"Enter":n.length>=3&&q({number:n});break}},P=i=>{i.key===d.current&&y()};return c.useEffect(()=>{if(n.length!==Se())return e(null);e(ie(n))},[n]),s(U.div,{...j("left","keypad",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.KEYPAD.TITLE")}),t(Pe,{onClick:()=>{if(u(""),S)N(S,"Keypad");else{let i=ie(n);i?(A({...i,number:n}),r("NewContact")):(A({number:n}),r("NewContact"))}}})]})}),t("div",{className:"content noscroll",children:s("div",{className:"keypad-container",children:[t("div",{className:"inputbox",children:t("div",{className:"input",style:{fontSize:`${h}rem`},children:F(n)})}),t("div",{className:"keypad-wrapper",children:s("div",{className:"keypad",children:[De.map(i=>s("div",{onMouseDown:()=>L(i.key),onMouseUp:()=>y(),children:[i.key,i.letters&&t("span",{children:i.letters})]},i.key)),t("span",{}),t("div",{className:"call",onClick:()=>{n.length>=3&&q({number:n})},children:t(le,{})}),t("div",{className:"delete",onMouseDown:()=>{if(!he("Phone"))return;L("delete"),g.current&&clearInterval(g.current);const i=setInterval(()=>{L("delete")},100);g.current=i},onMouseUp:()=>{g.current&&(clearInterval(g.current),g.current=null)},children:t(Te,{})})]})})]})})]})}function xe(){const{View:o,Contact:E}=c.useContext(z),N=b(w.PhoneNumber),[f]=E,[r,C]=o,A=b(R.APPS.PHONE.contacts),S=b(w.Settings),[e,n]=c.useState(null),[u,v]=c.useState(!1);c.useEffect(()=>{w.Styles.TextColor.set(S.display.theme=="dark"?"#ffffff":"#000000")},[]),c.useEffect(()=>{f&&f.number&&n({...e,number:f.number})},[f]),c.useEffect(()=>{e&&v(e.firstname&&e.number!==void 0)},[e]);const m=()=>{if(e){if(!e.number||(e==null?void 0:e.number)===N)return C("Contacts");e.lastname=(e==null?void 0:e.lastname)??"",k("Phone",{action:"saveContact",data:e},!0).then(d=>{if(!d)return T("warning","Failed to save contact");R.APPS.PHONE.contacts.set([...A,e]),C("Contacts")})}};return s(U.div,{...j("up","newcontact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[t("div",{className:"back",onClick:()=>C("Contacts"),children:a("APPS.PHONE.CANCEL")}),t("span",{className:u?"":"disabled",onClick:()=>{u&&m()},children:a("APPS.PHONE.DONE")})]})}),t("div",{className:"content",children:t(M,{children:s("div",{className:"contact nohover",children:[t("div",{className:"user",onClick:()=>{var d,g,h;H.Gallery.set({allowExternal:(h=(g=(d=re)==null?void 0:d.value)==null?void 0:g.AllowExternal)==null?void 0:h.Other,onSelect:p=>n({...e,avatar:p.src})})},children:e!=null&&e.avatar?s(M,{children:[t("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${e.avatar})`}}),t("span",{children:a("APPS.PHONE.EDIT")})]}):s(M,{children:[t(ae,{className:"big"}),t("span",{className:"add",children:a("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),s("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(G,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:d=>n({...e,firstname:d.target.value}),maxLength:20})}),t("div",{className:"item input",children:t(G,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:d=>n({...e,lastname:d.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(G,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:f==null?void 0:f.number,maxLength:15,onChange:d=>{let g=d.target.value.slice(-1).charCodeAt(0);g>=48&&g<=57&&n({...e,number:d.target.value})}})})})]})})})]})}const te=ce([]).mock(oe.RecentCalls);function Be(){const{viewContact:o}=c.useContext(z),[E,N]=c.useState("all"),f=b(te),r=["all","missed"],[C,A]=c.useState(0),[S,e]=c.useState(!1),[n,u]=c.useState(!1);c.useEffect(()=>{A(0),e(!1),k("Phone",{action:"getRecent",page:0,missed:E==="missed"},oe.RecentCalls.filter(m=>E==="missed"?!m.answered:!0)).then(m=>{if(!m)return T("error","Failed to get recent calls");te.set(m)})},[E]);const v=m=>{if(S||n)return;let d=document.querySelector("#last");if(!d)return;!ve(d)&&(u(!0),T("info","Fetching more recent calls, page: ",C+1),k("Phone",{action:"getRecent",page:C+1,missed:E==="missed"},null).then(h=>{h&&h.length>0?(te.set([...te.value,...h]),u(!1),T("info","Received more recent calls, page: ",C+1),h.length<25&&e(!0)):(T("info","Received all recent calls, nothing more to fetch. Page: ",C+1),e(!0))}),A(h=>h+1))};return s(U.div,{...j("left","recent",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items col",children:[t("div",{className:"selector-container",children:t("div",{className:"selector",children:r.map((m,d)=>t("div",{className:"option","data-active":E===m,onClick:()=>N(m),children:a(`APPS.PHONE.RECENTS.${m.toUpperCase()}`)},d))})}),t("div",{className:"title",children:a("APPS.PHONE.RECENTS.TITLE")})]})}),t("div",{className:"content",onScroll:v,children:t(U.div,{...j(E==="all"?"left":"right",E,.2),className:"recent-calls",children:f.map((m,d)=>{var p,$,y;let g=f.length-1===d?"last":"",h=ie(m.number);return s(U.div,{id:g,initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item","data-missed":!m.called&&!m.answered?"true":"false",onClick:()=>{if(m.hideCallerId)return;let L;h!=null&&h.name?L=h.name:L=F(m.number),H.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:L}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:L}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{q({number:m.number})}}]})},children:[s("div",{className:"user",children:[m.hideCallerId?t("div",{className:"avatar",style:{backgroundImage:`url(./assets/img/avatar-placeholder-${(y=($=(p=w)==null?void 0:p.Settings)==null?void 0:$.value)==null?void 0:y.display.theme}.svg)`}}):h!=null&&h.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${h==null?void 0:h.avatar})`}}):t("div",{className:"avatar",children:J(h==null?void 0:h.name)}),t("div",{className:"info",children:m.hideCallerId?s(M,{children:[a("APPS.PHONE.CALL.NO_CALLER_ID"),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]}):h!=null&&h.name?s(M,{children:[h.name,t("span",{children:F(m.number)})]}):s(M,{children:[F(m.number),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]})})]}),s("div",{className:"info",children:[t("div",{className:"date",children:ge(m.timestamp)}),t(Ne,{onClick:L=>{if(L.stopPropagation(),m.hideCallerId)return T("info","Call info couldn't be loaded since user called with 'No Caller ID'");h!=null&&h.name?o({...h,number:m.number},"Recents"):o({...m},"Recents")}})]})]},d)})})})]})}const me=ce(null),W=ce([]);function $e(){const o=b(W),[E,N]=c.useState(0),[f,r]=c.useState(!1),[C,A]=c.useState(!1);c.useEffect(()=>{N(0),r(!1),k("Phone",{action:"getVoiceMails",page:0},oe.VoiceMails).then(e=>{if(!e)return T("error","Failed to get voicemails");T("info","Received voicemails",e),W.set(e)})},[]);const S=()=>{if(f||C)return;let e=document.querySelector("#last");if(!e)return;!ve(e)&&(A(!0),T("info","Fetching more voicemails, page: ",E+1),k("Phone",{action:"getVoiceMails",page:E+1}).then(u=>{u&&u.length>0?(W.set([...W.value,...u]),A(!1),T("info","Received more voicemails, page: ",E+1),u.length<25&&r(!0)):(T("info","Received all voicemails, nothing more to fetch. Page: ",E+1),r(!0))}),N(u=>u+1))};return s(U.div,{...j("left","voicemail",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:t("div",{className:"items",children:t("div",{className:"title",children:a("APPS.PHONE.VOICEMAIL.TITLE")})})}),t("div",{className:"content",onScroll:S,children:t("div",{className:"voicemails",children:o.map(e=>{let n=o[o.length-1]?"last":"";return t(Ke,{data:e,last:n},e.id)})})})]})}const Ke=({data:o,last:E})=>{const N=b(re),f=b(w.Settings),r=c.useRef(null),[C,A]=c.useState(!1),[S,e]=c.useState(!1),[n,u]=c.useState(!1),[v,m]=c.useState(null),[d,g]=c.useState(0),h=b(me),[p,$]=c.useState(null),y=b(ke),L=b(Z);c.useEffect(()=>{var l;y!=null&&y.visible&&((l=r.current)==null||l.pause(),u(!1))},[y==null?void 0:y.visible,L==null?void 0:L.active]),c.useEffect(()=>{var I;r.current=new Audio(o.url),r.current.src=o.url,r.current.volume=f.sound.volume??.5,r.current.addEventListener("ended",()=>{u(!1)}),r.current.addEventListener("timeupdate",()=>{g(r.current.currentTime)});let l=(I=R.APPS.PHONE.contacts)==null?void 0:I.value;if(l&&o.number){let O=l.find(_=>_.number==o.number);O&&$(O)}return()=>{var O,_;(O=r.current)==null||O.pause(),(_=r.current)==null||_.remove(),r.current=null}},[]),c.useEffect(()=>{var l;h&&h!==o.id&&((l=r.current)==null||l.pause(),u(!1),A(!1))},[h]),c.useEffect(()=>{f.sound.volume&&(r.current.volume=f.sound.volume)},[f.sound.volume]),c.useEffect(()=>{var l;u(!1),g(0),(l=r.current)==null||l.pause(),r.current.currentTime=0,C&&me.set(o.id)},[C]);const x=l=>{l=l/1e3;const I=Math.floor(l/60),O=se(l-I*60,0);return`${I}:${O<10?"0"+O:O}`},P=(l,I)=>{const O=new Date(l),_=O.getFullYear(),K=O.getMonth()+1,B=O.getDate(),Y=O.getHours(),Q=O.getMinutes();return I?`${B} ${O.toLocaleDateString(N.DateLocale,{month:"long"})} ${_} ${a("APPS.PHONE.VOICEMAIL.AT")} ${Y}:${Q<10?"0"+Q:Q}`:`${_}-${K<10?"0"+K:K}-${B<10?"0"+B:B}`},i={light:{active:"#333333",track:"#cccccc"},dark:{active:"#FFFFFF",track:"#999999"}};return t(U.div,{className:"voicemail-item",id:E,initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},onClick:()=>A(!C),"data-expanded":C,children:s("div",{className:"voicemail-info",children:[s("div",{className:"voicemail-row",children:[s("div",{className:"details",children:[t("div",{className:"voicemail-title",children:o.hideCallerId?a("APPS.PHONE.CALL.NO_CALLER_ID"):p?X(p==null?void 0:p.firstname,p==null?void 0:p.lastname):F(o.number)}),t("div",{className:"subtitle",children:P(o.timestamp,!0)})]}),!C&&t("div",{className:"info",children:t("div",{className:"duration",children:x(o.duration)})})]}),t(be,{children:C&&s(U.div,{className:"voicemail-actions",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[s("div",{className:"voicemail-duration-slider",onClick:l=>l.stopPropagation(),children:[t(G,{type:"range",min:0,max:100,value:v||d/o.duration*100,style:{background:`linear-gradient(to right, ${i[f.display.theme].active} 0%, ${i[f.display.theme].active} ${v||d/(o.duration/1e3)*100}%, ${i[f.display.theme].track} ${v||d/(o.duration/1e3)*100}%, ${i[f.display.theme].track} 100%)`},onMouseDown:l=>{he("Phone")&&(l.stopPropagation(),e(!0))},onMouseUp:l=>{if(l.stopPropagation(),e(!1),v){if(!r.current)return T("warning","Audio ref is null");r.current.currentTime=o.duration/1e3/100*v,m(null)}},onChange:l=>{l.stopPropagation(),m(l.target.value)}}),s("div",{className:"duration",children:[t("div",{children:x(d)??"0:00"}),t("div",{children:x(o.duration)})]})]}),s("div",{className:"voicemail-item-footer",children:[t("div",{className:"play",onClick:l=>{if(l.stopPropagation(),!r.current)return T("warning","Audio ref is null");n?r.current.pause():r.current.play().catch(()=>T("error","Failed to play voicemail",o.id)),u(!n)},children:n?t(Le,{}):t(ye,{})}),s("div",{className:"buttons",children:[o.number&&s(M,{children:[t(le,{className:"green",onClick:l=>{l.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.DESCRIPTION").format({number:F(o.number)}),buttons:[{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.PROCEED"),cb:()=>{q({number:o.number})}}]})}}),t(ue,{className:"blue",onClick:l=>{l.stopPropagation(),Z.patch({active:{name:"Messages",data:{number:o.number,name:(p==null?void 0:p.firstname)&&X(p.firstname,p.lastname),avatar:p==null?void 0:p.avatar},view:"messages"}})}})]}),t(Ie,{className:"red",onClick:l=>{l.stopPropagation(),H.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.PROCEED"),cb:()=>{k("Phone",{action:"deleteVoiceMail",id:o.id},!0).then(I=>{if(!I)return T("error","Failed to delete voicemail");T("info","Deleted voicemail",o.id),W.set(W.value.filter(O=>O.id!==o.id))})}}]})}})]})]})]})})]})})};const z=c.createContext(null);function Xe(){const o=b(Z).active,[E,N]=c.useState("Contacts"),[f,r]=c.useState(null),C=b(R.APPS.PHONE.contacts),A=(n,u)=>{r({...n,from:u}),N("Contact")};c.useEffect(()=>{var n,u;if(C&&o!=null&&o.data)if(((n=o.data)==null?void 0:n.view)==="contact"){let v=C==null?void 0:C.find(m=>m.number==o.data.number);if(!v)return;r({...v||{number:o.data.number},from:"Contacts"}),N("Contact")}else((u=o.data)==null?void 0:u.view)==="newContact"&&(r({number:o.data.number,from:"Contacts"}),N("NewContact"))},[]);const S={Favourites:t(Ve,{}),Contacts:t(Ue,{}),Recents:t(Be,{}),Keypad:t(Fe,{}),NewContact:t(xe,{}),Contact:t(Me,{}),Voicemail:t($e,{})},e={Favourites:t(He,{}),Recents:t(_e,{}),Contacts:t(ae,{}),Keypad:t(we,{}),Voicemail:t(Re,{})};return s("div",{className:"phone-app-container",children:[t(z.Provider,{value:{Contact:[f,r],View:[E,N],viewContact:A},children:t("div",{className:"wrapper",children:S[E]})}),t("div",{className:"footer",children:Object.keys(e).map((n,u)=>{let v=E==n?"active":"";return s("div",{className:`item ${v}`,onClick:()=>N(n),children:[e[n],t("span",{children:a(`APPS.PHONE.${n.toUpperCase()}.TITLE`)})]},u)})})]})}export{z as PhoneContext,Xe as default};
