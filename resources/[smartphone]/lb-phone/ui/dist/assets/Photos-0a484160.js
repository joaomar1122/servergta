import{r as g,j as f,F as Z,a as e,t as Pe,H as q,u as N,s as S,q as h,p as T,aU as F,$ as me,m as G,S as ae,L as t,ay as ve,N as Y,aV as Ae,a2 as J,aW as le,a9 as he,x as fe,a1 as Se,aX as Oe,aY as ge,aZ as Ee,a_ as pe,C as R,I as ce,b as ie,a$ as Ce,b0 as Te,b1 as be,at as Q,n as ne,R as re,b2 as de,K as oe,b3 as Ie,b4 as Ne,ab as Me,b5 as Le,b6 as ye,E as ee,aa as Re,b7 as He,b8 as te,P as ue,A as _e}from"./index-a5f9a2c2.js";const W=({src:s,showAdvanced:c})=>{const[r,O]=g.useState(null);return f(Z,{children:[e("video",{src:s,crossOrigin:"anonymous",controls:!1,onMouseOver:E=>{c&&E.currentTarget.play()},onMouseOut:E=>{c&&E.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:E=>{O(E.currentTarget.duration)}}),r&&c&&e("div",{className:"video-duration",children:(E=>{const b=Math.floor(E/60),_=Pe(E-b*60,0);return`${b}:${_<10?"0"+_:_}`})(r)})]})},U=q(null),j=[{title:t("APPS.PHOTOS.VIDEOS"),id:"videos",icon:e(Se,{}),count:0},{title:t("APPS.PHOTOS.SELFIES"),id:"selfies",icon:e(Oe,{}),count:0},{title:t("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:e(ge,{}),count:0},{title:t("APPS.PHOTOS.IMPORTS"),id:"imports",icon:e(Ee,{}),count:0},{title:t("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:e(pe,{}),count:0}];function Ue(){const s=N(U),[c,r]=g.useState(!1),O=N(S.APPS.CAMERA.albums),p=N(S.APPS.CAMERA.mediaTypes);g.useEffect(()=>{var u,C;if(((u=S.APPS.CAMERA.albums.value)==null?void 0:u.length)>0&&((C=S.APPS.CAMERA.mediaTypes.value)==null?void 0:C.length)>0)return h("info","Album and mediatype cache exists, returning");T("Camera",{action:"getAlbums"},{albums:F.Albums,mediaTypes:F.MediaTypes}).then(o=>{if(!o)return h("error","No data received from server");let V=(p.length>0?p:j).map(M=>{const k=o.mediaTypes.find(x=>x.id===M.id);return k?{...M,count:k.count}:M});S.APPS.CAMERA.albums.set(o.albums),S.APPS.CAMERA.mediaTypes.set(V)})},[s]);const E=()=>{let u="";R.PopUp.set({title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:C=>{u=C}},buttons:[{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{T("Camera",{action:"createAlbum",title:u},!0).then(C=>{if(!C)return h("warning","Could not create album, id not returned");if(u.length<1)return h("warning","Input is empty, cannot create album");if(u.length>20)return h("warning","Input is too long, cannot create album");let o={title:u,id:C,cover:null,count:0,photoCount:0,videoCount:0};S.APPS.CAMERA.albums.set([...O,o])})}}]})},b=u=>{if(!u)return h("warning","No album id provided, cannot remove album");R.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:u.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:u.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{T("Camera",{action:"deleteAlbum",id:u.id},!0).then(C=>{if(!C)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(O.filter(o=>o.id!==u.id))})}}]})},_=me(u=>{let C=u.target;for(;!C.classList.contains("album");)C=C.parentElement;let o=parseInt(C.getAttribute("data-id"));if(!o)return h("warning","Could not obtain album id from element");R.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let H="";R.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:V=>{H=V}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(H.length<1)return h("warning","Input is empty, cannot rename album");h("warning","Renaming album",o,H),T("Camera",{action:"renameAlbum",id:o,title:H},!0).then(V=>{if(!V)return h("error","Could not rename album, server returned false");S.APPS.CAMERA.albums.set(O.map(M=>M.id===o?{...M,title:H}:M))})}}]})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>b(O.find(H=>H.id===o))}]})});return e(G.div,{...ae("right",s?"inAlbum":"albums"),style:{height:"100%",paddingBottom:"9rem"},children:s?e(Y,{children:e(De,{})}):f(Z,{children:[f("div",{className:"albums-header",children:[f("div",{className:"top",children:[e("div",{className:"edit",onClick:()=>r(!c),children:c?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.EDIT")}),e(ve,{onClick:E})]}),e("div",{className:"title",children:t("APPS.PHOTOS.ALBUMS")})]}),f("div",{className:"albums-content",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MY_ALBUMS")}),e("div",{className:"albums-grid","data-edit":c,children:e(Y,{children:O.map((u,C)=>f(G.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":u.id,"data-removable":u.removable,..._,onClick:()=>{c||U.set(u)},children:[c&&u.removable!==!1&&e("div",{className:"remove",onClick:o=>{o.stopPropagation(),b(u)},children:e(Ae,{})}),f("div",{className:"cover",children:[J(u.cover)?e(W,{src:u.cover,showAdvanced:!1}):e("img",{src:u.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),u.id==="favourites"&&e(le,{})]}),f("div",{className:"text",children:[e("div",{className:"title",children:u.title}),e("div",{className:"count",children:he(u.count)})]})]},C))})})]}),e("div",{className:"divider"}),f("div",{className:"media-types",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MEDIA_TYPES")}),e("div",{className:"media-types-items",children:p.map((u,C)=>f("div",{className:"item",onClick:()=>{if(c)return h("info","Edit mode is enabled, cannot open media type");U.set({...u,id:null,cover:null,type:u.id})},children:[f("div",{className:"type",children:[u.icon,u.title]}),f("div",{className:"action",children:[e("div",{className:"count",children:u.count}),e(fe,{})]})]},C))})]})]})})}const De=()=>{var x,$;const s=N(U),c=N(w),[r,O]=g.useState([]),[p,E]=g.useState([]),[b,_]=g.useState(!1),[u,C]=g.useState(!1),[o,H]=g.useState(!1),[V,M]=g.useState(0);g.useEffect(()=>{let P=s.id==="favourites"?F.Photos.filter(m=>m.favourite):s.id==="recents"?F.Photos:s.type==="videos"?F.Photos.filter(m=>m.isVideo):s.type?F.Photos.filter(m=>m.type===s.type):F.Photos.filter(m=>m.album===s.id);T("Camera",{action:"getImages",filter:{album:s.id,type:s.type}},P).then(m=>{if(!m)return h("warning","No data was returned from getImages event");E(m.reverse()),_(m.length===0)})},[]);const k=P=>{if(u||o)return;let m=document.querySelector("#last");if(!m)return;!oe(m)&&(H(!0),T("Camera",{action:"getImages",page:V+1,filter:{album:s.id,type:s.type}},null).then(i=>{i&&i.length>0?(E([...i.reverse(),...p]),H(!1),i.length<32&&C(!0)):C(!0)}),M(i=>i+1))};return f(G.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},className:"library",children:[e("div",{className:"library-header album",children:f("div",{className:"top",children:[e("div",{className:"back",children:e(ce,{onClick:()=>{U.set(null),w.set(!1)}})}),f("div",{className:"info",children:[e("div",{className:"title",children:s.title}),f("div",{className:"details",children:[t("APPS.PHOTOS.PHOTO_COUNT").format({amount:s.photoCount??0}),e("br",{}),t("APPS.PHOTOS.VIDEO_COUNT").format({amount:s.videoCount??0})]})]}),f("div",{className:"actions",style:{color:p.length<15?"var(--phone-color-blue)":"var(--phone-text-primary)"},children:[e("div",{className:"button",onClick:()=>w.set(!c),children:c?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")}),((($=(x=ie.value)==null?void 0:x.AllowExternal)==null?void 0:$.Gallery)||s.id!=="recents"&&s.id!=="favourites")&&e("div",{className:"button round",onClick:()=>{var m,d;let P=s.id!=="recents"&&s.id!=="favourites";R.ContextMenu.set({buttons:[((d=(m=ie.value)==null?void 0:m.AllowExternal)==null?void 0:d.Gallery)&&s.id!=="favourites"&&{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let i="";R.PopUp.set({title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:n=>{i=n}},buttons:[{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(i.includes("data:image"))return h("warning","Data URL not supported");if(!Ce(i)){setTimeout(()=>{R.PopUp.set({title:t("COMPONENTS.GALLERY.EXTERNAL_URL"),description:t("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),h("warning","External URL is blacklisted")},500);return}Te(i,n=>{if(!n)return h("error","Image does not exist");Ie(i,null,"import",!0).then(v=>{if(!v)return h("error","Could not save to gallery, server returned false");let I=J(i);E([{id:v,src:i,timestamp:Date.now(),type:"import",isVideo:I},...p]),T("Camera",{action:"getAlbums"}).then(L=>{if(!L)return h("error","No data received from server");let l=j.map(a=>{const A=L.mediaTypes.find(y=>y.id===a.id);return A?{...a,count:A.count}:a});S.APPS.CAMERA.albums.set(L.albums),S.APPS.CAMERA.mediaTypes.set(l)}),U.set({...s,photoCount:I?s.photoCount:s.photoCount+1,videoCount:I?s.videoCount+1:s.videoCount})})})}}]})}},P&&{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let i="";R.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:n=>{i=n}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(i.length<1)return h("warning","Input is empty, cannot rename album");h("info","Renaming album",s.id,i),T("Camera",{action:"renameAlbum",id:s.id,title:i},!0).then(n=>{if(!n)return h("error","Could not rename album, server returned false");U.set({...s,title:i}),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(v=>v.id===s.id?{...v,title:i}:v))})}}]})}},P&&{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{R.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:s.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:s.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{T("Camera",{action:"deleteAlbum",id:s.id},!0).then(i=>{if(!i)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.filter(n=>n.id!==s.id)),U.set(null)})}}]})}}]})},children:e(be,{})})]})]})}),f("div",{className:"library-content",style:{maxHeight:"40rem"},onScroll:k,children:[b&&f("div",{className:"no-photos",children:[e("div",{className:"title",children:t("APPS.PHOTOS.NO_PHOTOS")}),e("div",{className:"description",children:t("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),e("div",{className:"library-grid",children:p.map((P,m)=>f("div",{id:m===0?"last":"",className:"grid-item",onClick:()=>{if(c){const i=r.find(n=>n.id===P.id);O(i?r.filter(n=>n.id!==P.id):[...r,P])}else D.set({activeImage:P,images:p})},children:[P.isVideo?e(W,{src:P.src,showAdvanced:!c}):e("div",{className:"img",style:{backgroundImage:`url(${P.src})`}}),e("div",{className:"checkbox",children:c&&(r.find(i=>i.id===P.id)?e(Q,{checked:!0}):e(Q,{checked:!1}))})]},m))})]}),c&&f("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":r.length===0,children:e(ne,{})}),e("div",{className:"title",children:r.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:r.length})}),f("div",{className:"icons","data-disabled":r.length===0,children:[e(re,{onClick:()=>{if(r.length===0)return;let P=s.id!=="recents"&&s.id!=="favourites";R.ContextMenu.set({title:P&&t("APPS.PHOTOS.DELETE_CONTEXT_TITLE").format({type:r.length>1?t("APPS.PHOTOS.THESE_PHOTOS"):t("APPS.PHOTOS.THIS_PHOTO")}),buttons:[P&&{title:t("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{T("Camera",{action:"removeFromAlbum",album:s.id,ids:r.map(m=>m.id)},!0).then(m=>{if(!m)return h("error","Could not remove from album, server returned false");let d=s.photoCount-r.filter(n=>!n.isVideo).length,i=s.videoCount-r.filter(n=>n.isVideo).length;S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(n=>{if(n.id===s.id)return{...n,count:n.count-r.length,photoCount:d,videoCount:i}})),U.set({...s,photoCount:d,videoCount:i}),E(p.filter(n=>!r.find(v=>n.id===v.id))),O([]),w.set(!1)})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{T("Camera",{action:"deleteFromGallery",ids:r.map(m=>m.id)},!0).then(m=>{if(!m)return h("error","Could not delete from gallery, server returned false");let d=0;r.forEach(v=>{d+=v.size}),window.postMessage({action:"updateStorage",add:!1,size:d});let i=s.photoCount-r.filter(v=>!v.isVideo).length,n=s.videoCount-r.filter(v=>v.isVideo).length;T("Camera",{action:"getAlbums"}).then(v=>{if(!v)return h("error","No data received from server");let I=j.map(L=>{const l=v.mediaTypes.find(a=>a.id===L.id);return l?{...L,count:l.count}:L});S.APPS.CAMERA.albums.set(v.albums),S.APPS.CAMERA.mediaTypes.set(I)}),U.set({...s,photoCount:i,videoCount:n}),E(p.filter(v=>!r.find(I=>v.id===I.id))),O([]),w.set(!1)})}}]})}}),e(de,{onClick:()=>{r.length!==0&&R.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{X.set({images:r,onSelect:P=>{T("Camera",{action:"addToAlbum",album:P.id,ids:r.map(m=>m.id)},!0).then(m=>{if(!m)return h("error","Could not add to album, server returned false");O([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(d=>d.id===P.id?{...d,count:d.count+r.length,photoCount:d.photoCount+r.filter(i=>!i.isVideo).length,videoCount:d.videoCount+r.filter(i=>i.isVideo).length,cover:r[r.length-1].src}:d))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{T("Camera",{action:"toggleFavourites",ids:r.map(P=>P.id),favourite:!0},!0).then(P=>{if(!P)return h("error","Could not add to favourites, server returned false");O([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(m=>m.id==="favourites"?{...m,count:m.count+r.length,photoCount:m.photoCount+r.filter(d=>!d.isVideo).length,videoCount:m.videoCount+r.filter(d=>d.isVideo).length,cover:r[r.length-1].src}:m))})}}]})}})]})]})]})};t("APPS.PHOTOS.YEARS"),t("APPS.PHOTOS.MONTHS"),t("APPS.PHOTOS.DAYS"),t("APPS.PHOTOS.ALL_PHOTOS");function we(){const s=N(w),[c,r]=g.useState([]),[O,p]=g.useState([]),[E,b]=g.useState(!1);g.useState("all");const[_,u]=g.useState(null),[C,o]=g.useState(!1),[H,V]=g.useState(!1),[M,k]=g.useState(0),x=()=>{var B,K;let d=[],i=document.querySelectorAll(".grid-item");if(i.length===0||(i.forEach(z=>{!oe(z)&&d.push(z)}),d.length===0))return u(null);let n=d[0],v=parseInt(n==null?void 0:n.getAttribute("data-id"));if(!v)return;let I=(B=O.find(z=>z.id===v))==null?void 0:B.timestamp,L=d[d.length-1],l=parseInt(L.getAttribute("data-id")),a;if(l&&(a=(K=O.find(z=>z.id===l))==null?void 0:K.timestamp),!I)return;let A=$(I),y=$(a);if(A===y||!a)return u(A);u(`${A} - ${y}`)},$=d=>{let i=new Date(d/1e3),n=i.toLocaleString("default",{month:"short"}),v=i.getDate(),I=i.getFullYear();return`${v} ${n} ${I}`};g.useEffect(()=>{T("Camera",{action:"getImages"},F.Photos.sort((d,i)=>i.timestamp-d.timestamp).reverse()).then(d=>{if(!d)return h("warning","No data was returned from getImages event");p(d.reverse()),b(d.length===0)})},[]);const P=d=>{if(x(),C||H)return;let i=document.querySelector("#last");if(!i)return;!oe(i)&&(V(!0),T("Camera",{action:"getImages",page:M+1},null).then(v=>{v&&v.length>0?(p([...v.reverse(),...O]),V(!1),v.length<32&&o(!0)):o(!0)}),k(v=>v+1))},m=d=>d.reduce((i,n)=>{const v=Me(n.timestamp);return i[v]||(i[v]=[]),i[v].push(n),i},{});return f(G.div,{...ae("left","library"),style:{height:"100%"},children:[e("div",{className:"library-header",children:f("div",{className:"top",children:[e("div",{}),e("div",{className:"actions",children:e("div",{className:"button",onClick:()=>w.set(!s),children:s?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")})})]})}),e("div",{className:"library-content",style:{marginTop:"4rem",maxHeight:48.5-4+"rem"},"data-offset":O.length<15,onScroll:P,children:(()=>{let d=m(O);return Object.keys(d).map(i=>f("div",{className:"date-group",children:[e("div",{className:"date",children:i}),e("div",{className:"library-grid","data-zoomlevel":Fe[1].toString(),children:d[i].map((n,v)=>f("div",{id:v===0?"last":"",className:"grid-item","data-id":n.id,onClick:()=>{if(s){const L=c.find(l=>l.id===n.id);r(L?c.filter(l=>l.id!==n.id):[...c,n])}else D.set({activeImage:n,images:O})},children:[n.isVideo?e(W,{src:n.src,showAdvanced:!s}):e("div",{className:"img",style:{backgroundImage:`url(${n.src})`}}),e("div",{className:"checkbox",children:s&&(c.find(L=>L.id===n.id)?e(Q,{checked:!0}):e(Q,{checked:!1}))})]},n.id))})]},i))})()}),s&&f("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":c.length===0,children:e(ne,{})}),e("div",{className:"title",children:c.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:c.length})}),f("div",{className:"icons","data-disabled":c.length===0,children:[e(re,{onClick:()=>{c.length!==0&&R.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{T("Camera",{action:"deleteFromGallery",ids:c.map(d=>d.id)},!0).then(()=>{p(O.filter(i=>!c.find(n=>i.src===n.src))),r([]);let d=0;c.forEach(i=>{d+=i.size}),window.postMessage({action:"updateStorage",add:!1,size:d}),T("Camera",{action:"getAlbums"}).then(i=>{if(!i)return h("error","No data received from server");let n=j.map(v=>{const I=i.mediaTypes.find(L=>L.id===v.id);return I?{...v,count:I.count}:v});S.APPS.CAMERA.albums.set(i.albums),S.APPS.CAMERA.mediaTypes.set(n)})})}}]})}}),e(Ne,{onClick:()=>{c.length!==0&&R.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{X.set({images:c,onSelect:d=>{T("Camera",{action:"addToAlbum",album:d.id,ids:c.map(i=>i.id)},!0).then(i=>{if(!i)return h("error","Could not add to album, server returned false");r([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(n=>n.id===d.id?{...n,count:n.count+c.length,photoCount:n.photoCount+c.filter(v=>!v.isVideo).length,videoCount:n.videoCount+c.filter(v=>v.isVideo).length,cover:c[c.length-1].src}:n))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{T("Camera",{action:"toggleFavourites",ids:c.map(d=>d.id),favourite:!0},!0).then(d=>{if(!d)return h("error","Could not add to favourites, server returned false");r([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(i=>i.id==="favourites"?{...i,count:i.count+c.length,photoCount:i.photoCount+c.filter(n=>!n.isVideo).length,videoCount:i.videoCount+c.filter(n=>n.isVideo).length,cover:c[c.length-1].src}:i))})}}]})}})]})]})]})}function Ve(){var O,p,E;const s=N(X),c=N(S.APPS.CAMERA.albums);let r=(O=s==null?void 0:s.images)==null?void 0:O[(s==null?void 0:s.images.length)-1];return f(G.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[f("div",{className:"addtoalbum-header",children:[e("div",{}),e("div",{className:"title",children:t("APPS.PHOTOS.ADD_TO_ALBUM")}),e("div",{className:"cancel",onClick:()=>X.reset(),children:t("APPS.PHOTOS.CANCEL")})]}),f("div",{className:"addtoalbum-content",children:[f("div",{className:"preview",children:[J(r==null?void 0:r.src)?e(W,{src:r==null?void 0:r.src,showAdvanced:!1}):e("img",{src:r==null?void 0:r.src}),e("div",{className:"title",children:t("APPS.PHOTOS.SELECTED_COUNT").format({count:(p=s==null?void 0:s.images)==null?void 0:p.length})})]}),e("div",{className:"albums",children:(E=c==null?void 0:c.filter(b=>b.id!=="favourites"&&b.id!=="recents"))==null?void 0:E.map((b,_)=>f("div",{className:"album",onClick:()=>{s.onSelect(b),X.reset()},children:[e("div",{className:"cover",children:J(b.cover)?e(W,{src:b.cover,showAdvanced:!1}):e("img",{src:b.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),e("div",{className:"title",children:b.title}),e("div",{className:"count",children:b.count})]},_))})]})]})}function ke(){const s=N(se),[c,r]=g.useState([{icon:e(Le,{}),title:t("APPS.PHOTOS.GALLERY"),value:"library"},{icon:e(ye,{}),title:t("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return e("div",{className:"photos-footer",children:c.map((O,p)=>f("div",{className:"item","data-active":s===O.value,onClick:()=>{se.set(O.value),O.value==="albums"&&s==="albums"&&(U!=null&&U.value)&&U.reset()},children:[O.icon,O.title]},p))})}const Be=()=>{var i,n,v,I,L;const s=N(ie),c=N(ue.Settings),[r,O]=g.useState(!0),[p,E]=g.useState(!1),[b,_]=g.useState(0),u=g.useRef(null),C=g.useRef(null),o=N(D),[H,V]=g.useState(new Date(((n=(i=D==null?void 0:D.value)==null?void 0:i.activeImage)==null?void 0:n.timestamp)??0/1e3)),[M,k]=g.useState(((v=o==null?void 0:o.activeImage)==null?void 0:v.favourite)??!1),[x,$]=g.useState([]);let P=(o==null?void 0:o.images)??[];g.useEffect(()=>{if(!(o!=null&&o.activeImage))return h("warning","No active image when changing volume");if(o.activeImage.isVideo){const l=document.getElementById(o.activeImage.id);if(!l)return;l.volume=c.sound.volume}},[c.sound.volume]),g.useEffect(()=>{var a;if(!o)return;let l=P.findIndex(A=>A.id===o.activeImage.id);if(_(l),k(o.activeImage.favourite),o.activeImage.isVideo){const A=document.getElementById(o.activeImage.id);if(!A)return h("warning","Video Element not found (Carousel effect)");A.play().catch(()=>h("warning","Could not play video, user interaction required")),A.volume=c.sound.volume}if(P.length>0){let A=[];l===0?A=P.slice(0,12):l===P.length-1?A=P.slice(P.length-12,P.length):l<6?A=P.slice(0,12):l>P.length-6?A=P.slice(P.length-12,P.length):A=P.slice(l-6,l+6),V(new Date(((a=P==null?void 0:P[l])==null?void 0:a.timestamp)/1e3)),$(A)}},[o==null?void 0:o.activeImage]);const m={pos:{startLeft:0,startX:0},onMouseDown:l=>{ee("Photos")&&(m.pos={startLeft:u.current.scrollLeft,startX:l.clientX},u.current.style.userSelect="none",document.addEventListener("mouseup",m.onMouseUp),document.addEventListener("mousemove",m.onMove),E(!0))},onMove:l=>{if(!u.current)return;const a=(l.clientX-m.pos.startX)/te();u.current.scrollLeft=m.pos.startLeft-a;const A=u.current.getBoundingClientRect();(A.left*te()-5>l.clientX||l.clientX>A.right*te()-5)&&m.onMouseUp()},onMouseUp:()=>{if(!u.current)return;u.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",m.onMouseUp),document.removeEventListener("mousemove",m.onMove);const l=u.current.clientWidth;let a=b;const A=u.current.scrollLeft-m.pos.startLeft;if(A>l/2&&a<P.length?a++:A<-l/2&&a>0&&a--,o.activeImage.id!==P[a].id&&o.activeImage.isVideo){const B=document.getElementById(o.activeImage.id);B&&(B.pause(),B.currentTime=0)}D.set({activeImage:P[a],images:P});let y=document.getElementById(P[a].id);if(!y)return h("error","Could not find element to scroll into view");y.scrollIntoView({behavior:"smooth",block:"center"}),E(!1)}},d=l=>{o.activeImage.isVideo&&document.getElementById(o.activeImage.id).pause(),D.set({activeImage:l,images:P});let a=document.getElementById(l.id);if(!a)return h("error","Could not find element to scroll into view");a.scrollIntoView({behavior:"smooth",block:"center"})};return f(G.div,{initial:{opacity:0,scale:.25},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.25},transition:{duration:.2,ease:"easeInOut"},className:"activephoto-container",children:[e(Y,{children:r&&f(G.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"back",onClick:()=>{R.Share.reset(),D.reset()},children:e(ce,{})}),e("div",{className:"date",children:((I=o==null?void 0:o.activeImage)==null?void 0:I.timestamp)&&f(Z,{children:[H.toLocaleString([],{day:"2-digit",month:"long"}),e("span",{children:H.toLocaleTimeString(s.DateLocale,{hour:"numeric",minute:"numeric",hour12:c.time.twelveHourClock})})]})}),e("div",{children:((L=o==null?void 0:o.activeImage)==null?void 0:L.id)&&e(de,{onClick:()=>{R.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{X.set({images:[o.activeImage],onSelect:l=>{T("Camera",{action:"addToAlbum",album:l.id,ids:[o.activeImage.id]},!0).then(a=>{if(!a)return h("error","Could not add to album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(A=>A.id===l.id?{...A,count:A.count+1,photoCount:o.activeImage.isVideo?A.photoCount:A.photoCount+1,videoCount:o.activeImage.isVideo?A.videoCount+1:A.videoCount,cover:o.activeImage.src}:A))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{T("Camera",{action:"toggleFavourites",ids:[o.activeImage.id],favourite:!0},!0).then(l=>{if(!l)return h("error","Could not add to favourites, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(a=>a.id==="favourites"?{...a,count:a.count+1,photoCount:o.activeImage.isVideo?a.photoCount:a.photoCount+1,videoCount:o.activeImage.isVideo?a.videoCount+1:a.videoCount,cover:o.activeImage.src}:a))})}}]})}})})]})}),e("div",{className:"image-overflow",ref:u,onMouseDown:m.onMouseDown,onClick:()=>{p||O(!r)},children:P==null?void 0:P.map((l,a)=>{const A=l.id===o.activeImage.id;return l.isVideo?e("video",{id:l.id,src:l.src,className:A?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:y=>{ee("Photos")&&A&&(y.target.scrollIntoView({block:"center"}),y.target.play().catch(()=>h("warning","Could not play video, user interaction required")))}},a):e(Re,{id:l.id,src:l.src,className:A?"active":null,ignoreStreamerMode:!0,onLoad:y=>{ee("Photos")&&A&&y.target.scrollIntoView({block:"center"})}},a)})}),e(Y,{children:r&&f(G.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"photo-carousel",ref:C,children:x.map((l,a)=>{let A=l.id===(o==null?void 0:o.activeImage.id);return l.isVideo?e("video",{src:l.src,"data-active":A,"data-carousel":a,controls:!1,muted:!0,onClick:y=>d(l)},a):e("img",{src:l.src,"data-id":l.id,"data-active":A,"data-carousel":a,onClick:y=>d(l)},a)})}),f("div",{className:"photo-bottom",children:[e(ne,{onClick:()=>{R.Share.set({type:"image",data:{src:o.activeImage.src,isVideo:o.activeImage.isVideo}})}}),(o==null?void 0:o.activeImage.id)&&f(Z,{children:[e("div",{onClick:()=>{T("Camera",{action:"toggleFavourites",ids:[o.activeImage.id],favourite:!M},!0).then(l=>{if(!l)return h("warning","Failed to toggle favourite, server returned success false");k(!M),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(a=>a.id==="favourites"?{...a,count:M?a.count-1:a.count+1,photoCount:o.activeImage.isVideo?a.photoCount:M?a.photoCount-1:a.photoCount+1,videoCount:o.activeImage.isVideo?M?a.videoCount-1:a.videoCount+1:a.videoCount,cover:o.activeImage.src}:a))})},children:M?e(le,{}):e(He,{})}),e(re,{onClick:()=>{R.PopUp.set({title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{T("Camera",{action:"deleteFromGallery",ids:[o.activeImage.id]},!0).then(l=>{if(!l)return h("error","Could not delete from gallery, server returned false");D.reset(),T("Camera",{action:"getAlbums"}).then(a=>{if(!a)return h("error","No data received from server");let A=j.map(y=>{const B=a.mediaTypes.find(K=>K.id===y.id);return B?{...y,count:B.count}:y});S.APPS.CAMERA.albums.set(a.albums),S.APPS.CAMERA.mediaTypes.set(A)})})}}]})}})]})]})]})})]})};const se=q("albums"),w=q(!1),D=q(null),X=q(null),xe={library:e(we,{}),albums:e(Ue,{})},Fe=[2,3,4,5];function $e(){var _;const s=N(se),c=N(D),r=N(U),O=N(w),p=N(X),E=(_=N(_e))==null?void 0:_.active,b=N(ue.PhoneNumber);return g.useEffect(()=>{D.reset(),w.reset(),X.reset()},[b]),g.useEffect(()=>{E!=null&&E.data&&D.set({activeImage:{src:E.data.photo},images:[{src:E.data.photo}]})},[E]),f("div",{className:"photos-container",children:[e("div",{className:"photos-content","data-scroll":s==="albums"&&!r,style:{pointerEvents:c?"none":"all"},children:xe[s]}),!O&&e(ke,{}),e(Y,{children:c&&e(Be,{})}),e(Y,{children:p&&e(Ve,{})})]})}export{D as ActiveImage,X as AlbumPickerComponent,w as SelectMode,se as View,$e as default,Fe as zoomLevels};
