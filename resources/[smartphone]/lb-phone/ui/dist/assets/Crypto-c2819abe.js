import{r as d,j as h,a as s,N as U,m as A,u as b,bZ as w,b as f,q as g,p as N,_ as I,a9 as Y,t as T,L as t,ca as x,cb as B,w as k,cc as F,cd as $,C as O,f as D,P as j}from"./index-a5f9a2c2.js";function H({children:e,text:o}){const[m,S]=d.useState(!1);return h("div",{className:"tooltip-wrapper",onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),children:[e,s(U,{children:m&&s(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:s("div",{dangerouslySetInnerHTML:{__html:o}})})})]})}const L=d.createContext(null);function V(){var u;const e=b(f),o=b(j.Settings),[m,S]=d.useState(0),[C,v]=d.useState([]),[R,r]=d.useState(""),[c,y]=d.useState("0"),[P,i]=d.useState(o==null?void 0:o.streamerMode);d.useEffect(()=>{w()&&fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&sparkline=true&order=market_cap_desc&per_page=100&page=1&ids=${f.value.Crypto.Coins.join(",")}`).then(n=>n.json()).then(n=>{v(n.map(a=>{var p;return{id:a.id,name:a.name,symbol:a.symbol,image:a.image,current_price:a.current_price,prices:(p=a.sparkline_in_7d)==null?void 0:p.price,change_24h:a.price_change_percentage_24h}}))}).catch(n=>g("error",n)),N("Crypto",{action:"get"}).then(n=>{if(!n)return g("warning","No data received from Crypto NUI event");v(n)})},[]),I("crypto:updateCoins",n=>{if(!n)return g("warning","No data received from the update Crypto NUI event");v(n)}),d.useEffect(()=>S(C.reduce((n,a)=>n+(a.owned??0)*a.current_price,0)),[C]),d.useEffect(()=>{y(P?Y("âˆ—".repeat(T(m,2).toString().length)):Y(T(m,2)))},[m,P]);const l=n=>{let a={0:50,10:45,12:40,14:35},p=0;for(let E=0;E<Object.keys(a).length;E++)n.length>=parseInt(Object.keys(a)[E])&&(p=a[Object.keys(a)[E]]);return p};return h("div",{className:"crypto-container",children:[h("div",{className:"crypto-header",children:[s("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),t("APPS.CRYPTO.TITLE")]}),s(L.Provider,{value:{Coins:[C,v]},children:h("div",{className:"crypto-wrapper",children:[h("div",{className:"balance",children:[h("div",{className:"title",children:[t("APPS.CRYPTO.BALANCE"),s("div",{className:"icon",onClick:()=>i(!P),children:P?s(x,{}):s(B,{})})]}),s("div",{className:"amount",style:{fontSize:l(c.toString())},onClick:()=>i(!P),children:(u=e==null?void 0:e.CurrencyFormat)==null?void 0:u.replace("%s",c.toString())})]}),s("div",{className:"search",children:s(k,{placeholder:"Search Cryptocurrency",onChange:n=>r(n.target.value)})}),s(M,{search:R}),s("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const M=({search:e})=>{const[o,m]=d.useState("balance"),[S,C]=d.useState(!0),v=["Name","Graph","Balance"],[R]=d.useContext(L).Coins;return s("div",{className:"holdings",children:h("div",{className:"items",children:[s("div",{className:"item filters",children:v.map((r,c)=>h("div",{className:"filter",onClick:()=>{if(m(r.toLowerCase()),o===r.toLowerCase())return C(!S);C(!0)},children:[r,r.toLowerCase()===o&&S?s(F,{}):s($,{})]},c))}),R.sort((r,c)=>o==="name"?S?r.name.localeCompare(c.name):c.name.localeCompare(r.name):o==="graph"?S?r.change_24h-c.change_24h:c.change_24h-r.change_24h:o==="balance"?S?(c.owned??0)*c.current_price-(r.owned??0)*r.current_price:(r.owned??0)*r.current_price-(c.owned??0)*c.current_price:0).filter(r=>r.name.toLowerCase().includes(e.toLowerCase())||r.symbol.toLowerCase().includes(e.toLowerCase())).map((r,c)=>s(z,{data:r},c))]})})},z=({data:e})=>{const[o,m]=d.useState(!1),[S,C]=d.useState(""),[v,R]=d.useContext(L).Coins,r=(P,i)=>{i>1?N("Crypto",{action:"buy",coin:P,amount:i}).then(l=>{if(l!=null&&l.success)return R(u=>u.map(n=>n.id===P?{...n,owned:(n.owned??0)+i/n.current_price,value:(n.value??0)+i,invested:(n.invested??0)+i}:n));l!=null&&l.msg&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${l.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.BUY").toLowerCase(),currency:f.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},c=(P,i,l)=>{l>0?N("Crypto",{action:"sell",coin:P,amount:l}).then(u=>{if(u!=null&&u.success)return R(n=>n.map(a=>a.id===P?{...a,owned:(a.owned??0)-i/a.current_price,value:(a.value??0)+i,invested:(a.invested??0)-i}:a));u!=null&&u.msg&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${u.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.SELL").toLowerCase(),currency:f.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},y=(P,i,l,u)=>{l>0?N("Crypto",{action:"transfer",coin:P,amount:l,number:u}).then(n=>{n!=null&&n.success&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:i,coin:e.symbol,number:D(u)}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]}),R(a=>a.map(p=>p.id===P?{...p,owned:(p.owned??0)-i/p.current_price,value:(p.value??0)+i,invested:(p.invested??0)-i}:p))},250),n!=null&&n.msg&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${n.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:f.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),h("div",{className:"item",onClick:()=>m(!o),children:[h("div",{className:"top",children:[h("div",{className:"info",children:[s("img",{src:e.image,className:"icon",alt:"Icon"}),h("div",{className:"coin",children:[s("div",{className:"name",children:e.symbol}),s("div",{className:"symbol",children:e.name})]})]}),s(G,{data:e}),h("div",{className:"amount",children:[s("div",{className:"value",children:Y(T(e.owned,4))}),h("div",{className:"asset",children:["$",Y(T(e.value,2))]})]})]}),s(U,{children:o&&h(A.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[s(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:P=>{P.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:i=>C(i)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{C(i=>(r(e.id,parseFloat(i)),i))}}]})},children:t("APPS.CRYPTO.BUY")}),s(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:P=>{P.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:i=>C(i)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{C(i=>{let l=parseFloat(i),u=l/e.current_price;return c(e.id,l,u),i})}}]})},children:t("APPS.CRYPTO.SELL")}),s(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:P=>{P.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:i=>C(i)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{C(i=>{let l=parseFloat(i),u=l/e.current_price;return O.ContactSelector.set({onSelect:n=>{if(!n)return g("warning","No contact selected? Cancelling request");y(e.id,l,u,n.number)}}),i})}}]})},children:t("APPS.CRYPTO.TRANSFER")}),s(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:P=>{P.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let i=e.owned*e.current_price;c(e.id,i,e.owned)}}]})},children:t("APPS.CRYPTO.SELL_ALL")})]})})]})},G=e=>{if(!(e!=null&&e.data.prices))return null;let o=e.data.prices;const m=d.useRef(null),[S,C]=d.useState(null),[v,R]=d.useState(null);return o=o.slice(0,24),d.useEffect(()=>{if(!(m!=null&&m.current))return;const r=m.current;r.width=150,r.height=100;const c=r.getContext("2d");c.lineWidth=3;const y=Math.min(...o),i=Math.max(...o)-y,l=r.height-10;let u=0,n=r.height-5-(o[0]-y)/i*l;c.beginPath(),c.moveTo(u,n);const a=o[o.length-1]-o[0]>0?"green":"red";c.strokeStyle=a;for(let _=1;_<o.length;_++)u+=r.width/(o.length-1),n=r.height-5-(o[_]-y)/i*l,c.lineTo(u,n);c.stroke();const p=(o[o.length-1]-o[0])/o[0]*100;p>0?C(`<div style="color: var(--phone-color-green)">+${T(p,2)}%</div>`):p<0?C(`<div style="color: var(--phone-color-red)">${T(p,2)}%</div>`):C(`<div>${T(p,2)}%</div>`);let E=(e.data.value-e.data.invested)/e.data.invested*100;E>0?R(`<div style="color: var(--phone-color-green)">+${T(E,2)}%</div>`):E<0&&R(`<div style="color: var(--phone-color-red)">${T(E,2)}%</div>`)},[m,o]),s(H,{text:`$${T(e.data.current_price,2)} ${S??""} ${v??""}`,children:s("canvas",{ref:m})})};export{V as default};
