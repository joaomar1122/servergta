import{H as Fe,r as s,u as ae,ce as ke,q as _,bk as Xe,p as N,bb as Ae,_ as te,C as Y,L as n,j as a,a as e,a3 as ge,bO as Je,N as Ie,cf as De,d as le,F as j,m as Ee,b as he,aW as Le,b7 as Ue,P as ue,a2 as oe,cg as Qe,R as Ze,a7 as pe,J as et,E as xe,b8 as Ne,T as tt,A as He,ch as We,ci as qe,K as de,s as ie,x as Be,I as we,w as Oe,ai as $e,aj as fe,ar as Ye,au as at,al as st,am as nt,aF as it,cj as rt,t as ct,aa as ye,ab as Ve,aR as lt,cb as ot,bY as dt,ck as mt,c2 as ut,cl as ft,ae as ht,cm as gt,bh as vt}from"./index-a5f9a2c2.js";import{formatNumber as Pt}from"./Tiktok-07b12417.js";import"./Slider-7f52a59f.js";const ce=Fe({host:"",participants:[],viewers:0});function At(){var z,re,me,Se;const{View:i,Account:r,Func:C}=s.useContext(K),[l,A]=i,[g]=r,m=ae(he),d=ae(ce),[v,p]=s.useState(!1),[c,t]=s.useState(!1),[P,E]=s.useState(null),[w,f]=s.useState(""),S=s.useRef(null),O=s.useRef(null),L=s.useRef(null),[M,b]=s.useState(null),[x,I]=s.useState(null),[G,U]=s.useState(null),[o,u]=s.useState([]),[R,V]=s.useState([]),[h,W]=s.useState([]);s.useEffect(()=>{S.current.scrollTop=S.current.scrollHeight},[h]),s.useEffect(()=>{const T=m.rtc?new ke({config:m.rtc}):new ke;return T.on("open",F=>{b({peer:T,id:F})}),T.on("call",F=>{F.on("close",()=>{V(B=>B.filter(ee=>ee.connectionId!==F.connectionId))}),V(B=>[...B,F])}),_("info","Created peer"),()=>{try{for(let F of R)F.close()}catch{_("error","Failed to close calls")}try{T.destroy()}catch{_("error","Failed to destroy peer")}}},[]),s.useEffect(()=>{if(!G||L!=null&&L.current||!M)return;_("info","Creating game render");let T=new Xe(G);L.current=T,T.resizeByAspect(3/4);const F=window.innerWidth;F>1280&&T.setQuality(1280/F);let B;if(x||v){_("info","Host is true, creating call"),v?N("Instagram",{action:"setLive",username:g.username,verified:g.verified,id:M.id}):x&&N("Instagram",{action:"joinLive",username:x,streamId:M.id}).then(Q=>{if(I(null),!Q)return _("error","Failed to join live");t(!0)});const ee=G.captureStream(24);B=Q=>{_("info","Answering call",Q),Q.answer(ee)},M.peer.on("call",B)}return()=>{B&&M.peer.off("call",B),L.current&&L.current.destroy(),L.current=null}},[G,M]);const y=T=>{T.forEach(F=>{if(F.username===g.username)return _("info","Skipping self");_("info","Adding participant",F);const B=document.createElement("canvas"),ee=B.captureStream(0),Q=M.peer.call(F.id,ee);V(ve=>[...ve,Q]),Q.on("close",B.remove),Q.on("error",B.remove),Q.on("stream",ve=>{N("Instagram",{action:"addCall",id:Q.connectionId,username:F.username}),u(Ce=>[...Ce,{stream:ve,username:F.username}])})})},$=T=>{T.forEach(F=>{_("info","Removing participant",F),F.username===g.username&&t(!1),u(B=>B.filter(ee=>ee.username!==F.username))})};s.useEffect(()=>{const T=d.participants;if(!T||!M)return _("warning","No participants");const F=T.filter(ee=>!o.find(Q=>Q.username===ee.username));F.length&&y(F),_("info","Added",F);const B=o.filter(ee=>!T.find(Q=>Q.username===ee.username));B.length&&$(B),_("info","Removed",B)},[d.participants,M]),s.useEffect(()=>{const T=g.username===(d==null?void 0:d.host);if(p(T),Ae.ShouldClose.set(!1),!!T)return u(F=>[...F,{username:d.host}]),()=>{Ae.ShouldClose.set(!0)}},[]);const q=()=>{Y.PopUp.set({title:v?n("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(v?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE")).toLowerCase()}),buttons:[{title:n("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:v?n("APPS.INSTAGRAM.END_LIVE_POPUP.END"):n("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{H(v)}}]})},k=()=>{N("Instagram",{action:"sendLiveMessage",data:{user:{username:g.username,avatar:g.avatar,verified:g.verified},live:d.host,content:w}}),f("")},H=(T,F)=>{if(v)N("Instagram",{action:"endLive"}).then(()=>{A("feed")});else if(c&&N("Instagram",{action:"endLive"}).then(()=>{A("feed")}),N("Instagram",{action:"stopViewing",username:d.host}),T)Ae.ShouldClose.set(!0),ce.patch({ended:!0});else{if(F===!1)return;A("feed")}};return te("instagram:addMessage",T=>{T.live===d.host&&W(F=>[...F,T])}),te("instagram:updateViewers",T=>{T.username===(d==null?void 0:d.host)&&ce.patch({viewers:T.viewers})}),te("instagram:setLive",T=>{ce.set(T)}),te("instagram:liveEnded",T=>{T===(d==null?void 0:d.host)&&H(!0)}),te("instagram:stopLive",()=>A("feed")),te("instagram:endCall",T=>{const F=R.find(B=>B.connectionId===T);F&&(F.close(),V(B=>B.filter(ee=>ee.connectionId!==T)))}),te("instagram:invitedLive",T=>{T===(d==null?void 0:d.host)&&Y.PopUp.set({title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:T}),buttons:[{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:n("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{I(T),u(F=>[...F,{username:g.username}])}}]})}),te("instagram:joinedLive",T=>{T.host===(d==null?void 0:d.host)&&ce.patch({participants:[...d.participants,T]})}),te("instagram:leftLive",T=>{T.host===(d==null?void 0:d.host)&&(_("info","left live",T),ce.patch({participants:d.participants.filter(F=>F.username!==T.participant)}))}),a("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":o.length.toString(),children:o.map((T,F)=>T.username===g.username?a("div",{className:"instagram-stream",children:[e("canvas",{ref:B=>{_("info","setting canvas ref",B),U(B)}}),!v&&e(ge,{onClick:()=>{Y.PopUp.set({title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{N("Instagram",{action:"endLive"}),t(!1)}}]})}})]}):e(St,{host:v,stream:T.stream,username:T.username},`stream-${F}`))}),d.ended&&a("div",{className:"instagram-stream-ended",children:[e(Je,{onClick:()=>A("feed")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(Ie,{children:P&&e(pt,{username:d.host,type:P,host:P==="participants"?v||c:v,endLive:H,close:()=>E(null)})}),a("div",{className:"instagram-live",children:[a("div",{className:"live-header",children:[a("div",{className:"profile",onClick:()=>{o.length>1?E("participants"):!v&&!c&&(H(),C.fetchAndSetProfile(d.host))},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${C.getAvatar((re=(z=d==null?void 0:d.participants)==null?void 0:z[0])==null?void 0:re.avatar)})`}}),a("div",{className:"name",children:[e(Nt,{usernames:d.participants.map(T=>T.username)}),((Se=(me=d==null?void 0:d.participants)==null?void 0:me[0])==null?void 0:Se.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(De,{})]})]}),a("div",{className:"stats",children:[e("div",{className:"live",children:n("APPS.INSTAGRAM.LIVE")}),a("div",{className:"viewers",onClick:()=>E("viewers"),children:[e("i",{className:"fas fa-eye"}),d.viewers]}),e("i",{className:"far fa-times x",onClick:()=>{v||c?q():H(!1)}})]})]}),a("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:S,children:h.map((T,F)=>{let B=C.getAvatar(T.user.avatar);return a("div",{className:"comment",children:[e("img",{src:B}),a("div",{className:"info",children:[a("div",{className:"name",children:[T.user.username,T.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:T.content})]})]},F)})}),a("div",{className:"comment-input",children:[e(le,{type:"text",ref:O,placeholder:n("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:T=>f(T.target.value),onKeyDown:T=>{T.key==="Enter"&&w.replace(/ /g,"").length>0&&(k(),O.current.value="")}}),e("i",{className:"far fa-paper-plane",onClick:()=>{w.replace(/ /g,"").length>0&&(k(),O.current.value="")}}),(v||c)&&e("i",{className:"fas fa-repeat",onClick:()=>{N("Instagram",{action:"flipCamera"})}})]})]})]})]})}const St=i=>{const r=s.useRef(null);return s.useEffect(()=>{if(!(r!=null&&r.current))return _("warning","No video ref");r.current.srcObject=i.stream,r.current.play().catch(()=>_("error","Failed to play video stream"))},[i==null?void 0:i.stream]),a("div",{className:"instagram-stream",children:[i.host&&e(ge,{onClick:()=>{Y.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:i.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:i.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{N("Instagram",{action:"removeLive",username:i.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:r})]})},Nt=i=>{let r=i.usernames.map((C,l)=>C).join(", ");return r.length>9&&(r=r.substring(0,9)+"..",r[r.length-3]===","&&(r=r.substring(0,r.length-3)+"..")),e(j,{children:r})},pt=i=>{var g;const{Func:r}=s.useContext(K),C=(g=ae(ce))==null?void 0:g.participants,[l,A]=s.useState([]);return s.useEffect(()=>{var m;if(i.type==="participants"){A((m=ce.value)==null?void 0:m.participants);return}N("Instagram",{action:"getLiveViewers",username:i.username}).then(d=>{d&&A(d)})},[]),a(Ee.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>i.close()}),e("div",{className:"title",children:i.type==="viewers"?n("APPS.INSTAGRAM.WHOS_WATCHING"):n("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:l.map((m,d)=>a("div",{className:"item",children:[a("div",{className:"user",onClick:()=>{i.host||(i.endLive(!1,!1),r.fetchAndSetProfile(m.username))},children:[e("div",{className:"profile-picture",children:e("img",{src:r.getAvatar(m.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[m.username,m.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:m.name})]})]}),i.host&&i.type==="viewers"&&(C.find(v=>v.username===m.username)?e("div",{className:"remove",onClick:v=>{v.stopPropagation(),Y.PopUp.set({title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:m.username}),description:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:m.username}),buttons:[{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{N("Instagram",{action:"removeLive",username:m.username}).then(()=>{})}}]})},children:n("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:v=>{v.stopPropagation(),N("Instagram",{action:"inviteLive",username:m.username})},children:n("APPS.INSTAGRAM.INVITE")}))]},d))})})]})};function ze(i){const r=ae(ue.Settings);return e(j,{children:i.liked?e(Le,{onClick:i.onClick,color:"#ed4956"}):e(Ue,{onClick:i.onClick,color:r.display.theme==="dark"?"#ffffff":"#262626"})})}function Ke(i){const{Account:r,View:C,Func:l,UserPanel:A}=s.useContext(K),[g]=r,[m,d]=C,[v,p]=A,[c,t]=s.useState(i.data),P=s.useRef(null),[E,w]=s.useState(0),[f,S]=s.useState(!1),O=ae(tt),L=ae(He),M={pos:{startLeft:0,startX:0},onMouseDown:I=>{xe("Instagram")&&(M.pos={startLeft:P.current.scrollLeft,startX:I.clientX},P.current.style.userSelect="none",document.addEventListener("mouseup",M.onMouseUp),document.addEventListener("mousemove",M.onMove))},onMove:I=>{const G=(I.clientX-M.pos.startX)/Ne();P.current.scrollLeft=M.pos.startLeft-G;const U=P.current.getBoundingClientRect();(U.left*Ne()-5>I.clientX||I.clientX>U.right*Ne()-5)&&M.onMouseUp()},onMouseUp:()=>{P.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",M.onMouseUp),document.removeEventListener("mousemove",M.onMove);const I=JSON.parse(c.media),G=P.current.clientWidth;let U=E;const o=P.current.scrollLeft-M.pos.startLeft;o>G/2&&U<I.length-1?U++:o<-G/2&&U>0&&U--,b(U)}},b=I=>{P.current.scrollTo({left:I*P.current.offsetWidth,behavior:"smooth"}),w(I)};te("instagram:updatePostData",I=>{if(!I||I.postId!==c.id)return _("warning","instagram:updatePostData","Post ID's do not match");t(G=>({...G,[I.data]:I.increment?G[I.data]+1:G[I.data]-1}))});const x=I=>{if(I.detail===2){if(!c.id)return;c.liked||N("Instagram",{action:"toggleLike",data:{postId:c.id,toggle:!c.liked,isComment:!1}},!c.liked).then(G=>{t(U=>({...U,liked:G})),S(!0),setTimeout(()=>S(!1),1e3)})}};return a("div",{className:"post",id:i.last?"last":"","data-id":c.id,"data-active":i.active,children:[a("div",{className:"post-header",children:[e("img",{className:"profile-picture",onClick:()=>l.fetchAndSetProfile(c.username),src:l.getAvatar(c.avatar)}),a("div",{className:"post-info",children:[a("div",{className:"name",onClick:()=>l.fetchAndSetProfile(c.username),children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),c.location&&e("div",{className:"location",children:c.location})]})]}),a("div",{className:"post-body",children:[f&&e("div",{className:"popup-heart","data-visible":f,children:e(Le,{})}),e("div",{className:"image-container",ref:P,onMouseDown:M.onMouseDown,children:JSON.parse(c.media).map((I,G)=>{var U;return e("div",{className:"image",onClick:x,children:oe(I)?e(It,{attachment:I,active:i.active&&!(O!=null&&O.visible)&&((U=L==null?void 0:L.active)==null?void 0:U.name)==="Instagram"}):e("img",{src:I})},G)})}),a("div",{className:"actions",children:[a("div",{className:"like-comment",children:[e(ze,{liked:c.liked,onClick:()=>{c.id&&N("Instagram",{action:"toggleLike",data:{postId:c.id,toggle:!c.liked,isComment:!1}},!c.liked).then(I=>{t(G=>({...G,liked:I}))})}}),e(Qe,{onClick:()=>l.fetchAndSetComments({id:c.id,username:c.username,avatar:c.avatar,verified:c.verified,caption:c.caption,timestamp:c.timestamp})}),(c.username===g.username||g.isAdmin)&&e(Ze,{onClick:()=>{Y.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:n("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"deletePost",id:c.id},!0).then(I=>{if(!I)return _("error","Instagram","Failed to delete post");d("feed")})}}]})}})]}),JSON.parse(c.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(c.media).map((I,G)=>e("div",{className:`dot ${E==G?"active":""}`,onClick:()=>b(G)},G))})]}),a("div",{className:"liked-by",onClick:()=>{p({display:!0,data:{title:n("APPS.INSTAGRAM.LIKED_BY"),postId:c.id,cb:()=>{d("feed")}}})},children:[c.like_count," ",n("APPS.INSTAGRAM.LIKES")]}),a("div",{className:"caption",children:[e("span",{className:"user",onClick:I=>{I.stopPropagation(),l.fetchAndSetProfile(c.username)},children:c.username}),pe(c.caption)," "]}),e("div",{className:"comments",onClick:I=>{I.stopPropagation(),l.fetchAndSetComments({id:c.id,username:c.username,avatar:c.avatar,verified:c.verified,caption:c.caption,timestamp:c.timestamp})},children:c.comment_count>0?n("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:c.comment_count}):n("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:et(c.timestamp)})]})]})}const It=i=>{var g;const[r,C]=s.useState(i.active),l=ae(ue.Settings),A=s.useRef(null);return s.useEffect(()=>{var m;C(i.active),!(!A.current||!((m=l==null?void 0:l.sound)!=null&&m.volume))&&i.active&&(A.current.volume=l.sound.volume,A.current.currentTime=0)},[i.active]),s.useEffect(()=>{var m;!A.current||!((m=l==null?void 0:l.sound)!=null&&m.volume)||i.active&&(A.current.volume=l.sound.volume)},[(g=l==null?void 0:l.sound)==null?void 0:g.volume]),e("video",{src:i.attachment,autoPlay:!0,loop:!0,muted:!i.active,ref:A,onLoadedMetadata:m=>{i.active&&(m.currentTarget.volume=l.sound.volume)}})},X={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,following:2,followers:13,posts:2,followingList:["loaf","breze"],followerList:["loaf","breze"]},breze:{username:"breze",name:"Breze",bio:`Hey, its breze 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","loaf"],followerList:["lb","loaf"]},loaf:{username:"loaf",name:"Loaf Scripts",bio:`Loaf Scritps official account 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","breze"],followerList:["lb","breze"]}},posts:[{id:"1",username:"breze",name:"Breze",verified:!0,caption:"sunsets are the best",media:'["https://r2.fivemanage.com/images/GRBUI6C4orbD.webp", "https://r2.fivemanage.com/images/rafgjPwSYnn2.png"]',location:"Sandy Shores",like_count:2,comment_count:0,timestamp:Date.now()-1e3*60*60*24*1},{id:"2",username:"lb",name:"LB",verified:!0,caption:"dump",media:'["https://r2.fivemanage.com/images/upTPndukc2PD.webp", "https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp"]',location:"Los Santos",like_count:8,comment_count:2,timestamp:Date.now()-1e3*60*60*24*2}],stories:[{id:"1",username:"lb",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,seen:0,media:[{id:"2",image:"https://r2.fivemanage.com/images/oRKcdeTA8oBy.png",timestamp:Date.now()-1e3*60*60*4,seen:!1,views:2,viewers:[{username:"Breze"},{username:"Loaf"}]}]},{id:"2",username:"breze",verified:!0,seen:0,media:[{id:"1",image:"https://r2.fivemanage.com/images/otBLdXG7WFeu.webp",timestamp:Date.now()-1e3*60*60*2,seen:!1},{id:"2",image:"https://r2.fivemanage.com/images/ZsmnyJOA2rc5.png",timestamp:Date.now()-1e3*60*60*3,seen:!1}]},{id:"3",username:"loaf",verified:!0,seen:1,media:[{id:"1",image:"https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp",timestamp:Date.now()-1e3*60*60*3,seen:!0},{id:"2",image:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*4,seen:!0}]}],comments:[{postId:"2",user:{username:"breze",verified:!0},comment:{id:"1",content:"nice",timestamp:Date.now()-1e3*60*60*24,likes:0}},{postId:"2",user:{username:"loaf",verified:!0},comment:{id:"2",content:"haha, nice picture",timestamp:Date.now()-1e3*60*60*22,likes:1,liked:!0}}],messages:[{id:"1",username:"breze",name:"Breze",verified:!0,content:"hey",messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,content:"yoo, your last post was fire",messages:[{id:"3",sender:"loaf",content:"yoo, your last post was fire",timestamp:Date.now()-1e3*60*60*8}],timestamp:Date.now()-1e3*60*60*8}],notifications:[{type:"like_photo",username:"loaf",name:"Loaf Scripts",postId:"1",photo:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Et(){const{Account:i,View:r,Func:C,Stories:l}=s.useContext(K),[A,g]=r,[m]=i,[d,v]=s.useState([]),[p,c]=s.useState([]),[t,P]=l,[E,w]=s.useState(0),[f,S]=s.useState(!1),[O,L]=s.useState(!1),[M,b]=s.useState(null);s.useEffect(()=>{N("Instagram",{action:"getPosts",filters:{following:!0},page:0},X.posts).then(o=>{if(!o)return _("error","Failed to fetch posts");v(o)})},[]),s.useEffect(()=>{A==="feed"&&(N("Instagram",{action:"getLives"}).then(o=>{o&&c(o)}),N("Instagram",{action:"getStories"},X.stories).then(o=>{if(!o)return _("warning","Failed to fetch stories");P([...o.sort((u,R)=>{if(u.seen===R.seen)return 0;if(u.seen===1)return 1;if(R.seen===1)return-1})])}))},[A]);const x=new IntersectionObserver(I,{rootMargin:"20px",threshold:.5});function I(o){o.forEach(u=>{if(u.isIntersecting){let V=u.target.getAttribute("data-id");b(V)}})}const G=()=>{if(f||O)return;let o=document.querySelector("#last");if(!o)return;document.querySelectorAll(".post").forEach(V=>x.observe(V)),!de(o)&&(L(!0),N("Instagram",{action:"getPosts",filters:{following:!0},page:E+1},null).then(V=>{V&&V.length>0?(v([...d,...V]),L(!1)):S(!0)}),w(V=>V+1))};s.useEffect(()=>{const o=document.querySelector(".stories");return o.addEventListener("wheel",u=>{u.preventDefault(),o.scrollLeft+=u.deltaY}),()=>{o.removeEventListener("wheel",u=>{u.preventDefault(),o.scrollLeft+=u.deltaY})}},[]),te("instagram:updateLives",o=>{o&&c(o)});const U=()=>{Y.PopUp.set({title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:n("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"goLive",user:{username:m.username,avatar:C.getAvatar(m==null?void 0:m.avatar),verified:m.verified}}).then(o=>{if(!o)return _("error","Failed to go live");ce.set({host:m.username,participants:[{username:m.username,name:m.username,avatar:C.getAvatar(m==null?void 0:m.avatar),verified:m.verified}],viewers:0}),g("live")})}}]})};return a(j,{children:[a("div",{className:"instagram-header feed-header",children:[a("div",{className:"name",children:[m.username,m.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e(We,{onClick:()=>g("dmList")})]}),a("div",{className:"feed",onScroll:G,children:[e("div",{className:"stories-wrapper",children:a("div",{className:"stories",children:[a("div",{className:"story self",onClick:()=>{Y.ContextMenu.set({buttons:[{title:n("APPS.INSTAGRAM.GO_LIVE"),cb:()=>U()},{title:n("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var o,u,R;Y.Gallery.set({includeVideos:!0,allowExternal:(R=(u=(o=he)==null?void 0:o.value)==null?void 0:u.AllowExternal)==null?void 0:R.InstaPic,onSelect:V=>{N("Instagram",{action:"addToStory",media:V.src},Math.random().toString(36).substring(7)).then(h=>{if(!h)return _("error","Failed to add story");P([{username:m.username,avatar:m.avatar,verified:m.verified,seen:0,id:h},...t.filter(W=>W.username!==m.username)])})}})}}]})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${C.getAvatar(m==null?void 0:m.avatar)})`},children:e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})}),e("div",{className:"name",children:n("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(p).map(o=>{var u;return a("div",{className:"story",onClick:()=>{var R;N("Instagram",{action:"viewLive",username:((R=p[o])==null?void 0:R.participant)??o}).then(V=>{var y,$,q,k;if(!V)return _("error","Failed to view live, perhaps it ended?");let h=(y=p[o])!=null&&y.participant?p[($=p[o])==null?void 0:$.participant]:p[o],W=(h==null?void 0:h.participants)??[];W.unshift({username:((q=p[o])==null?void 0:q.participant)??o,name:h.name,avatar:h.avatar,verified:h.verified,id:h.id}),ce.set({host:((k=p[o])==null?void 0:k.participant)??o,participants:W,viewers:V}),g("live")})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${C.getAvatar((u=p[o])==null?void 0:u.avatar)})`},children:e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"})}),e("div",{className:"name",children:o})]},o)}),t.map(o=>a("div",{className:"story",onClick:u=>{let[R,V]=qe(u);C.fetchAndSetStory(o,null,{x:R,y:V})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${C.getAvatar(o==null?void 0:o.avatar)})`},children:e("img",{className:"circle","data-seen":o.seen===1,src:"./assets/img/icons/instagram/StoryCircle.svg"})}),e("div",{className:"name",children:o.username})]},o.username))]})}),d.length===0&&e("div",{className:"no-posts",children:n("APPS.INSTAGRAM.EMPTY_FEED")}),d.map((o,u)=>{let R=u===d.length-1;return e(Ke,{data:o,active:M===o.id,last:R},o.id)})]})]})}function _e(){const{View:i,Account:r,LoggedIn:C}=s.useContext(K),l=ae(ue.Settings),[A,g]=s.useState(""),[m,d]=s.useState(""),[v,p]=s.useState(""),[c,t]=i,[P,E]=r,[w,f]=C,[S,O]=s.useState("login"),L=()=>{N("Instagram",{action:"logIn",username:m,password:v},{success:!!X.accounts[m],account:X.accounts[m]}).then(b=>{if(b.success&&b.account)N("isAdmin",null,!1).then(x=>{ie.APPS.INSTAGRAM.account.set(b.account),E({...b.account,isAdmin:x}),t("feed"),f(!0)});else{if(b.error)return Y.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n(`APPS.INSTAGRAM.${b.error}`),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});_("error","Instagram LogIn Error",b.error)}})},M=()=>{let b=m.toLowerCase().replace(/\s/g,"");b.length<3||b.length>15||N("Instagram",{action:"createAccount",name:A,username:b,password:v},{success:!X.accounts[b]}).then(x=>{if(x.success)N("isAdmin").then(I=>{let G={name:A,username:b,posts:0,followers:0,following:0};ie.APPS.INSTAGRAM.account.set(G),E({...G,isAdmin:I}),t("feed"),f(!0)});else{if(x.error)return Y.PopUp.set({title:n("APPS.INSTAGRAM.ERROR"),description:n(`APPS.INSTAGRAM.${x.error}`),buttons:[{title:n("APPS.INSTAGRAM.OK")}]});_("error","couldn't create account",x)}})};return s.useEffect(()=>{g(""),d(""),p("")},[S]),e("div",{className:"log-in",children:a(j,{children:[e("div",{className:"wrapper",children:S==="login"?a(j,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":l.display.theme}),a("div",{className:"form",children:[e(le,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:b=>d(b.target.value.replace(/\s/g,"")),maxLength:15},1),e(le,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:b=>p(b.target.value),maxLength:50},3),e("div",{className:"button",onClick:L,children:n("APPS.INSTAGRAM.LOG_IN")})]})]}):a(j,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":l.display.theme}),a("div",{className:"form",children:[e(le,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:b=>g(b.target.value),maxLength:20},2),e(le,{placeholder:n("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:b=>d(b.target.value.replace(/\s/g,"")),maxLength:15},4),e(le,{placeholder:n("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:b=>p(b.target.value),maxLength:50}),e("div",{className:"button",onClick:M,children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:S==="login"?a(j,{children:[n("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>O("createAccount"),children:n("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):a(j,{children:[n("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>O("login"),children:n("APPS.INSTAGRAM.LOG_IN")})]})})]})})}const Re=Fe(!1);function Ct(){var t,P,E,w,f;const{Func:i}=s.useContext(K),[r,C]=s.useState(null),l=ae(Re),[A,g]=s.useState(0),[m,d]=s.useState(!1),[v,p]=s.useState(!1);s.useEffect(()=>{N("Instagram",{action:"getNotifications"},X.notifications).then(S=>{if(!S)return _("warning","Failed to fetch notifications, or no results?");C(S)})},[]);const c=()=>{if(m||v)return;let S=document.querySelector("#last");if(!S)return;!de(S)&&(p(!0),N("Instagram",{action:"getNotifications",page:A+1},null).then(L=>{L&&(L==null?void 0:L.notifications.length)>0?(C(M=>({...M,notifications:[...M.notifications,...L.notifications]})),p(!1)):d(!0)}),g(L=>L+1))};return a("div",{className:"notifications-container",children:[e(Ie,{children:l&&e(wt,{})}),e("div",{className:"notifications-header",children:n("APPS.INSTAGRAM.ACTIVITY")}),a("div",{className:"notifications-body",onScroll:c,children:[((t=r==null?void 0:r.requests)==null?void 0:t.total)>0&&a("div",{className:"follow-requests",onClick:()=>Re.set(!0),children:[a("div",{className:"item-data",children:[e("div",{className:"profile-pictures","data-multiple":r.requests.total>1,children:r.requests.recent.map((S,O)=>e("img",{src:i.getAvatar(S.avatar)},O))}),a("div",{className:"item-body",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("div",{className:"subtitle",children:r.requests.total>1?n("APPS.INSTAGRAM.ANDOTHERS").format({username:(P=r.requests.recent[0])==null?void 0:P.username,amount:((E=r.requests)==null?void 0:E.total)-1}):(w=r.requests.recent[0])==null?void 0:w.username})]})]}),a("div",{className:"actions",children:[e("div",{className:"blue-dot"}),e(Be,{})]})]}),(f=r==null?void 0:r.notifications)==null?void 0:f.map((S,O)=>{let L=O===r.notifications.length-1?"last":"";return e(Tt,{notification:S,last:L},O)})]})]})}const wt=()=>{const{Func:i}=s.useContext(K),[r,C]=s.useState(""),[l,A]=s.useState([]),[g,m]=s.useState(0),[d,v]=s.useState(!1),[p,c]=s.useState(!1),t=[{class:"follow",label:n("APPS.INSTAGRAM.CONFIRM"),action:!0},{class:"following",label:n("APPS.INSTAGRAM.DELETE"),action:!1}];s.useEffect(()=>{N("Instagram",{action:"getFollowRequests",page:0},[]).then(E=>{if(!E)return _("warning","Failed to fetch follow requests");_("info","Fetched follow requests",E),A(E)})},[]);const P=()=>{if(d||p)return;let E=document.querySelector("#lastrequest");if(!E)return;!de(E)&&(c(!0),N("Instagram",{action:"getFollowRequests",page:g+1},null).then(f=>{f&&(f==null?void 0:f.length)>0?(A(f),c(!1)):v(!0)}),m(f=>f+1))};return a(Ee.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"requests-container",children:[a("div",{className:"requests-header",children:[e("div",{className:"icon",children:e(we,{onClick:()=>Re.set(!1)})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("span",{})]}),a("div",{className:"requests-body",children:[e(Oe,{placeholder:n("SEARCH"),onChange:E=>C(E.target.value)}),e("div",{className:"items",onScroll:P,children:l.filter(E=>E.username.toLowerCase().includes(r.toLowerCase())||E.name.toLowerCase().includes(r.toLowerCase())).map((E,w)=>{let f=w===l.length-1?"lastrequest":"";return a("div",{id:f,className:"item",children:[a("div",{className:"user",onClick:()=>i.fetchAndSetProfile(E.username),children:[e("img",{className:"avatar",src:i.getAvatar(E.avatar)}),a("div",{className:"user-info",children:[a("div",{className:"username",children:[E.username,E.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:E.name})]})]}),e("div",{className:"buttons",children:t.map((S,O)=>e("div",{className:$e("button",S.class),onClick:L=>{L.stopPropagation(),N("Instagram",{action:"handleFollowRequest",username:E.username,accept:S.action},!0).then(M=>{if(!M)return _("warning","Failed to handle follow request");A(b=>b.filter(x=>x.username!==E.username))})},children:S.label},O))})]},w)})})]})]})},Tt=({notification:i,last:r})=>{const{Account:C,Func:l}=s.useContext(K),[A]=C,[g,m]=s.useState(i.isFollowing);switch(i.type){case"like_photo":return a("div",{className:"notification-item",id:r,onClick:()=>l.fetchAndSetPost(i.postId),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:v=>{v.stopPropagation(),l.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:fe(i.timestamp)})]})]}),oe(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"like_comment":return e("div",{className:"notification-item",id:r,onClick:()=>l.fetchAndSetPost(i.postId,!0),children:a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:v=>{v.stopPropagation(),l.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:i.comment}),e("span",{className:"date",children:fe(i.timestamp)})]})]})});case"comment":return a("div",{className:"notification-item",id:r,onClick:()=>l.fetchAndSetPost(i.postId,!0),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:v=>{v.stopPropagation(),l.fetchAndSetProfile(i.username)}}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.COMMENTED").format({comment:i.comment}),e("span",{className:"date",children:fe(i.timestamp)})]})]}),oe(i.photo)?e("video",{className:"post-preview",src:i.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:i.photo})]});case"follow":return a("div",{className:"notification-item",id:r,onClick:()=>l.fetchAndSetProfile(i.username),children:[a("div",{className:"notification-body",children:[e("img",{className:"avatar",src:l.getAvatar(i.avatar),onClick:()=>l.fetchAndSetProfile(i.username)}),a("div",{className:"content",children:[e("span",{children:i.username})," ",n("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:fe(i.timestamp)})]})]}),e("div",{className:`button ${g?"following":"follow"}`,onClick:v=>{v.stopPropagation(),A.username!==i.username&&(g?Y.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:i.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"toggleFollow",data:{username:i.username,following:!g}},!0).then(()=>{m(p=>!p)})}}]}):N("Instagram",{action:"toggleFollow",data:{username:i.username,following:!g}},!0).then(()=>{m(p=>!p)}))},children:g?n("APPS.INSTAGRAM.FOLLOWING"):n("APPS.INSTAGRAM.FOLLOW")})]})}};function Rt(){var F,B,ee,Q,ve,Ce;const{View:i,Profile:r,Account:C,Func:l,GoBack:A,Post:g,UserPanel:m,LoggedIn:d,Dm:v}=s.useContext(K),[p,c]=i,[t,P]=r,[E,w]=d,[f,S]=C,[O,L]=g,[M,b]=v,[x,I]=m,[G,U]=A,[o,u]=s.useState(!1),[R,V]=s.useState(!1),[h,W]=s.useState(null),[y,$]=s.useState(0),[q,k]=s.useState(!1),[H,z]=s.useState(!1);s.useEffect(()=>{t.username&&(u(f.username===t.username),N("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:0}).then(D=>{D&&W(D)}))},[t==null?void 0:t.username]);const re=()=>{if(q||H)return;let D=document.querySelector("#last");if(!D)return;!de(D)&&(z(!0),N("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:y+1}).then(Z=>{Z&&Z.length>0?(W([...h,...Z]),z(!1)):k(!0)}),$(Z=>Z+1))},me=()=>{if(!t.name)return _("warning","Name is required, not saving");N("Instagram",{action:"updateProfile",data:{name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}},!0).then(D=>{if(!D)return _("warning","Failed to update profile");ie.APPS.INSTAGRAM.account.set({...f,name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}),V(!1),_("info","Successfully updated profile")})};te("instagram:updateProfileData",D=>{D.username===t.username&&P({...t,[D.data]:D.increment?t[D.data]+1:t[D.data]-1})});const Se=s.useRef(!0);s.useEffect(()=>{if(Se.current){Se.current=!1;return}N("Instagram",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}},!0)},[t.isFollowing]);const T=()=>{N("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(D=>{var se;if(!D)return _("info","No accounts found");let J=f.isAdmin,Z=(se=D==null?void 0:D.filter(ne=>ne!==t.username))==null?void 0:se.map(ne=>({title:ne,cb:()=>{N("AccountSwitcher",{action:"switch",app:"Instagram",account:ne}).then(Te=>{N("Instagram",{action:"isLoggedIn"}).then(Pe=>{Pe?(ie.APPS.INSTAGRAM.account.set(Pe),S({...Pe,isAdmin:J}),c("feed"),w(!0)):ie.APPS.INSTAGRAM.account.set(null)})})}}));Y.ContextMenu.set({buttons:[{title:f.username},...Z,{title:n("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>{w(!1)}}]})})};return e(j,{children:t&&a("div",{className:"profile",children:[e(Ie,{children:R&&a(Ee.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[a("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>V(!1),children:n("CANCEL")}),e("div",{className:"title",children:n("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>me(),children:n("APPS.INSTAGRAM.DONE")})]}),a("div",{className:"edit-profile-body",children:[a("div",{className:"profile-picture",onClick:()=>{var D,J,Z;Y.Gallery.set({allowExternal:(Z=(J=(D=he)==null?void 0:D.value)==null?void 0:J.AllowExternal)==null?void 0:Z.InstaPic,onSelect:se=>{P({...t,avatar:se.src}),S({...f,avatar:se.src})}})},children:[e("img",{src:l.getAvatar(t.avatar),alt:"profile"}),e("span",{children:n("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),a("div",{className:"profile-items",children:[a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.NAME")}),e(le,{placeholder:n("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:D=>{P({...t,name:D.target.value})},maxLength:30,defaultValue:t.name})]}),a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.BIO")}),e(Ye,{placeholder:n("APPS.INSTAGRAM.BIO"),onChange:D=>{P({...t,bio:D.target.value})},maxLength:100,defaultValue:t.bio??""})]}),a("div",{className:"item",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE")}),e("div",{className:"switch-wrapper",children:e(at,{checked:t.private,onChange:()=>P({...t,private:!t.private})})})]})]}),a("div",{className:"buttons",children:[e("div",{className:"button blue",onClick:()=>{Y.PopUp.set({title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"signOut"},!0).then(D=>{if(!D)return _("error","Failed to sign out");w(null),S(null),ie.APPS.INSTAGRAM.account.set(null)})}}]})},children:n("APPS.INSTAGRAM.SIGN_OUT")}),((ee=(B=(F=he)==null?void 0:F.value)==null?void 0:B.ChangePassword)==null?void 0:ee.InstaPic)&&e("div",{className:"button red",onClick:()=>st("Instagram",()=>{}),children:n("APPS.INSTAGRAM.CHANGE_PASSWORD")}),((Ce=(ve=(Q=he)==null?void 0:Q.value)==null?void 0:ve.DeleteAccount)==null?void 0:Ce.InstaPic)&&e("div",{className:"button red",onClick:()=>{nt("Instagram",()=>{w(null),S(null),ie.APPS.INSTAGRAM.account.set(null)})},children:n("APPS.INSTAGRAM.DELETE_ACCOUNT")})]})]})]})}),o?e("div",{className:"instagram-header",children:a("div",{className:"name",style:{cursor:"pointer"},onClick:()=>T(),children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(De,{})]})}):a("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{G!=null&&G.cb?G.cb():c("feed")}}),a("div",{className:"name",children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),a("div",{className:"profile-body",children:[a("div",{className:"profile-wrapper",children:[a("div",{className:"top",children:[a("div",{className:"profile-picture",style:{backgroundImage:`url(${l.getAvatar(t.avatar)})`},children:[t.isLive&&(!t.private||t.isFollowing||!o)?e("img",{onClick:()=>{N("Instagram",{action:"getLives"}).then(D=>{var Z;let J=t.username;N("Instagram",{action:"viewLive",username:((Z=D[J])==null?void 0:Z.participant)??J}).then(se=>{var Pe,Me,be,Ge;if(!se)return _("error","Failed to view live, perhaps it ended?");let ne=(Pe=D[J])!=null&&Pe.participant?D[(Me=D[J])==null?void 0:Me.participant]:D[J],Te=(ne==null?void 0:ne.participants)??[];Te.unshift({username:((be=D[J])==null?void 0:be.participant)??J,name:ne.name,avatar:ne.avatar,verified:ne.verified,id:ne.id}),ce.set({host:((Ge=D[J])==null?void 0:Ge.participant)??J,participants:Te,viewers:se}),c("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"}):null,t.hasStory&&!t.isLive&&(!t.private||t.isFollowing||o)?e("img",{className:"circle","data-seen":t.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.svg",onClick:D=>{let[J,Z]=qe(D);l.fetchAndSetStory({username:t.username,avatar:t.avatar,verified:t.verified},null,{x:J,y:Z})}}):null]}),a("div",{className:"stats",children:[a("div",{children:[e("div",{className:"value",children:t.posts}),e("div",{className:"label",children:t.posts===1?n("APPS.INSTAGRAM.POST"):n("APPS.INSTAGRAM.POSTS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!o,onClick:()=>{!t.isFollowing&&t.private&&!o||I({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWERS"),username:t.username,cb:()=>{P(t),c("profile"),I({display:!1})}}})},children:[e("div",{className:"value",children:t.followers}),e("div",{className:"label",children:t.followers===1?n("APPS.INSTAGRAM.FOLLOWER"):n("APPS.INSTAGRAM.FOLLOWERS")})]}),a("div",{"data-disabled":!t.isFollowing&&t.private&&!o,onClick:()=>{!t.isFollowing&&t.private&&!o||I({display:!0,data:{title:n("APPS.INSTAGRAM.FOLLOWING"),username:t.username,cb:()=>{P(t),c("profile"),I({display:!1})}}})},children:[e("div",{className:"value",children:t.following}),e("div",{className:"label",children:n("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:t.name}),e("div",{className:"description",children:pe(t.bio)??""}),e("div",{className:"buttons",children:o?o&&e("div",{className:"button edit",onClick:()=>V(!0),children:n("APPS.INSTAGRAM.EDIT_PROFILE")}):a(j,{children:[e("div",{className:$e("button",t.requested||t.isFollowing?"following":"follow"),onClick:()=>{t.isFollowing?Y.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{P({...t,isFollowing:!1})}}]}):t.private?N("Instagram",{action:"toggleFollow",data:{username:t.username,following:!0}},!0).then(D=>{D&&P({...t,requested:!t.requested})}):P({...t,isFollowing:!0})},children:t.isFollowing?n("APPS.INSTAGRAM.FOLLOWING"):t.requested?n("APPS.INSTAGRAM.REQUESTED"):n("APPS.INSTAGRAM.FOLLOW")}),!t.private||t.isFollowing?e("div",{className:"button following",onClick:()=>{b({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),c("dm")},children:n("APPS.INSTAGRAM.MESSAGE")}):null]})})]}),t.private&&!t.isFollowing&&!o?a("div",{className:"private-account",children:[e("div",{className:"icon",children:e(it,{})}),e("div",{className:"title",children:n("APPS.INSTAGRAM.PRIVATE_ACCOUNT")}),e("div",{className:"description",children:n("APPS.INSTAGRAM.PRIVATE_ACCOUNT_DESCRIPTION")})]}):e("div",{className:"posts",onScroll:re,children:h&&h.map((D,J)=>{let Z=J===h.length-1?"last":"",se=JSON.parse(D.media)[0];return e("div",{id:Z,onClick:()=>{U({cb:()=>{P(t),c("profile"),L(null),U(null)}}),L(D),c("post")},children:oe(se)?e("video",{src:se,muted:!0,autoPlay:!0,loop:!0}):e("img",{src:se})},J)})})]})]})})}function Lt(){const{Func:i,View:r,GoBack:C,Post:l}=s.useContext(K),[A,g]=r,[m,d]=C,[v,p]=l,[c,t]=s.useState(""),[P,E]=s.useState(""),[w,f]=s.useState([]);s.useState([]);const[S,O]=s.useState([]),[L,M]=s.useState(0),[b,x]=s.useState(!1),[I,G]=s.useState(!1);s.useEffect(()=>{N("Instagram",{action:"getPosts",page:0},X.posts).then(o=>{o&&O(o)})},[]),s.useEffect(()=>{const o=setTimeout(()=>t(P),500);return()=>clearTimeout(o)},[P]),s.useEffect(()=>{c.length>0&&N("Instagram",{action:"search",query:c},Object.keys(X.accounts).map(o=>X.accounts[o])).then(o=>{o&&f(o)})},[c]);const U=()=>{if(b||I||c.length>0)return;let o=document.querySelector("#last");if(!o)return;!de(o)&&(G(!0),N("Instagram",{action:"getPosts",page:L+1},null).then(R=>{R&&R.length>0?(O([...S,...R]),G(!1)):x(!0)}),M(R=>R+1))};return a("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(Oe,{placeholder:n("SEARCH"),onChange:o=>E(o.target.value)})}),e("div",{className:"search-body",onScroll:U,children:c.length>0?e("div",{className:"search-results",children:w.map(o=>a("div",{className:"item",onClick:()=>i.fetchAndSetProfile(o.username),children:[e("div",{className:"profile-picture",children:e("img",{src:i.getAvatar(o.avatar),alt:"profile"})}),a("div",{className:"user",children:[a("div",{className:"username",children:[o.username,o.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:o.name})]})]}))}):e("div",{className:"feed-grid",children:S.map((o,u)=>{let V=Math.floor(u/3)%2==0,h=!1;h=u%3==(V?1:0),S[u+1]||(h=!1);let W=JSON.parse(o.media)[0],y=u==S.length-1?"last":"";return e("div",{id:y,className:`grid-post${h?" big":""}`,onClick:()=>{d({cb:()=>{g("search"),d(null)}}),p(o),g("post")},children:oe(W)?e("video",{src:W,autoPlay:!0,loop:!0,muted:!0}):e("img",{src:W,alt:"post"})},u)})})})]})}function Ot(){const{View:i,GoBack:r,Comments:C,Account:l,Func:A}=s.useContext(K),[g]=l,[m,d]=i,[v]=r,[p,c]=C,[t,P]=s.useState(""),E=s.useRef(null),[w,f]=s.useState(0),[S,O]=s.useState(!1),[L,M]=s.useState(!1),b=()=>{t.length!==0&&N("Instagram",{action:"postComment",data:{postId:p.post.id,comment:t}},Math.random().toString(36).substring(7)).then(I=>{if(!I)return _("error","Failed to post comment, no ");P(""),E.current.value="",c({...p,post:p.post,comments:[{user:{username:g.username,avatar:g.avatar,verified:g.verified},comment:{id:I,content:t,timestamp:new Date().getTime(),likes:0,liked:!1}},...p.comments]})})},x=()=>{if(S||L)return;let I=document.querySelector("#last");if(!I)return;!de(I)&&(M(!0),N("Instagram",{action:"getComments",postId:p.post.id,page:w+1},null).then(U=>{U&&U.length>0?(c({...p,comments:[...p.comments,...U]}),M(!1)):O(!0)}),f(U=>U+1))};return a("div",{className:"comments-container",children:[a("div",{className:"comments-header",children:[e(we,{onClick:()=>{v&&(v!=null&&v.cb)?v.cb():d("feed")}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),a("div",{className:"comments-body",onScroll:x,children:[a("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(p.post.avatar),alt:"profile"})}),a("div",{className:"post-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",children:[p.post.username,p.post.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),pe(p.post.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:je(p.post.timestamp)})})]})]}),p.comments.map((I,G)=>{let U=G===p.comments.length-1;return e(Mt,{data:I,last:U},G)})]}),a("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e("img",{src:A.getAvatar(g.avatar),alt:"profile"})}),a("div",{className:"input-container",children:[e(le,{type:"text",ref:E,placeholder:n("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:g.username}),onKeyPress:I=>{I.key==="Enter"&&b()},onChange:I=>P(I.target.value)}),e("div",{className:"send",onClick:b,children:n("APPS.INSTAGRAM.POST")})]})]})]})}const Mt=({data:i,last:r})=>{const{Func:C}=s.useContext(K),[l,A]=s.useState(i.comment.liked),[g,m]=s.useState(i.comment.likes);return te("instagram:updateCommentLikes",d=>{!d||d.commentId!==i.comment.id||m(v=>v+(d.increment?1:-1))}),a("div",{className:"comment",id:r&&"last",children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:()=>C.fetchAndSetProfile(i.user.username),children:e("img",{src:C.getAvatar(i.user.avatar),alt:"profile"})}),a("div",{className:"comment-data",children:[a("div",{className:"caption",children:[a("span",{className:"username",onClick:()=>C.fetchAndSetProfile(i.user.username),children:[i.user.username,i.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),i.comment.content]}),a("div",{className:"actions",children:[e("div",{className:"date",children:je(i.comment.timestamp)}),a("div",{className:"likes",children:[g," ",n("APPS.INSTAGRAM.LIKES").toLowerCase()]})]})]})]}),e(ze,{liked:l,onClick:()=>{i.comment.id&&N("Instagram",{action:"toggleLike",data:{postId:i.comment.id,toggle:!l,isComment:!0}},!l).then(d=>{A(d)})}})]})},je=i=>{const r=new Date(i),l=new Date().getTime()-r.getTime(),A=Math.floor(l/(1e3*60*60*24)),g=Math.floor(l/(1e3*60*60)),m=Math.floor(l/(1e3*60));let d="";return A<1?g<1?d=`${m}m`:d=`${g}h`:A<30?d=`${A}d`:d=`${r.getDate()}/${r.getMonth()+1}/${r.getFullYear()}`,d};function bt(){const{View:i}=s.useContext(K),[r,C]=i,[l,A]=s.useState(0),[g,m]=s.useState([]),[d,v]=s.useState(""),[p,c]=s.useState(null);return s.useEffect(()=>{var t,P,E;l===0&&Y.Gallery.set({allowExternal:(E=(P=(t=he)==null?void 0:t.value)==null?void 0:P.AllowExternal)==null?void 0:E.InstaPic,multiSelect:!0,includeVideos:!0,onCancel:()=>C("feed"),onSelect:w=>{w!=null&&w.length?m(w.map(f=>f.src)):m([w.src]),A(1)}})},[l]),e("div",{className:"newpost-container","data-camera":!1,children:l===1&&a(j,{children:[a("div",{className:"newpost-header",children:[e(we,{onClick:()=>A(0)}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{N("Instagram",{action:"newPost",data:{caption:d,location:p,images:g}},!0).then(t=>{if(!t)return _("warning","Failed to post");C("feed")})},children:n("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:a("div",{className:"newpost-content",children:[a("div",{className:"caption",children:[e("div",{className:"attachments",style:{width:`calc(4rem + ${g.length*20}px)`},children:g.slice(0,5).map((t,P)=>e("div",{className:"attachment",style:{left:`${P*20}px`,top:`${P*5}px`,zIndex:P+1},children:oe(t)?e(Gt,{src:t}):e("img",{src:t,alt:"image"})},P))}),e("div",{className:"text-area",children:e(Ye,{onChange:t=>v(t.target.value),placeholder:n("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{Y.PopUp.set({title:"Choose Location",description:"Choose a location for your post",input:{type:"text",maxCharacters:30,onChange:t=>c(t)},buttons:[{title:"Cancel"},{title:"Proceed"}]})},children:p?a(j,{children:[a("div",{className:"label",children:[e(rt,{}),p]}),e(ge,{onClick:t=>{t.stopPropagation(),c(null)}})]}):a(j,{children:[e("div",{className:"label",children:"Location"}),e(Be,{})]})})]})})]})})}const Gt=({src:i})=>{const[r,C]=s.useState(null);return a(j,{children:[e("video",{src:i,crossOrigin:"anonymous",controls:!1,onMouseOver:A=>A.currentTarget.play(),onMouseOut:A=>A.currentTarget.pause(),onLoadedMetadata:A=>C(A.currentTarget.duration)}),r&&e("div",{className:"video-duration",children:(A=>{const g=Math.floor(A/60),m=ct(A-g*60,0);return`${g}:${m<10?"0"+m:m}`})(r)})]})};function kt(){const{View:i,Post:r,GoBack:C}=s.useContext(K),[l,A]=i,[g]=C,[m]=r;return e(j,{children:m&&e("div",{className:"viewpost-container",children:a(j,{children:[a("div",{className:"viewpost-header",children:[e(we,{onClick:()=>{g&&(g.cb?g.cb():A(g.view))}}),e("div",{className:"name",children:m.username??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(Ke,{data:m})})]})})})}function yt(){const{Func:i,Account:r,Dm:C,View:l,GoBack:A}=s.useContext(K);ae(ue.Settings);const[g]=r,[m,d]=l,[v,p]=C,[c,t]=A,[P,E]=s.useState([]),w=s.useRef(null),f=s.useRef(0),[S,O]=s.useState({content:"",attachments:[]}),[L,M]=s.useState(0),[b,x]=s.useState(!1),[I,G]=s.useState(!1);s.useEffect(()=>{var u;x(!1),G(!1),M(0),E([]),N("Instagram",{action:"getMessages",page:0,username:v.username},((u=X.messages.find(R=>R.username===v.username))==null?void 0:u.messages)??[]).then(R=>{R&&E(R.reverse())})},[]),te("instagram:newMessage",u=>{if(v.username!==u.sender)return;E([...P,u]);let R=document.querySelector(".dm-body-container");R.scrollTop=R.scrollHeight});const U=()=>{S.content.length===0&&S.attachments.length===0||N("Instagram",{action:"sendMessage",username:v.username,message:{content:S.content,attachments:S.attachments.length>0?S.attachments:null}},!0).then(u=>{if(!u)return;w.current.value="",E([...P,{sender:g.username,recipient:v.username,content:S.content,attachments:S.attachments,timestamp:Date.now()}]),O({content:"",attachments:[]});let R=document.querySelector(".dm-body-container");R.scrollTop=R.scrollHeight})},o=()=>{if(b||I)return;let u=document.querySelector("#last");if(!u)return;!de(u)&&(G(!0),N("Instagram",{action:"getMessages",page:L+1,username:v.username},null).then(V=>{if(V&&V.length>0){let h=document.querySelector(".dm-body-container");f.current=h.scrollHeight,E([...V.reverse(),...P]),G(!1)}else x(!0)}),M(V=>V+1))};return s.useEffect(()=>{let u=document.querySelector(".dm-body-container");const R=u.scrollHeight;u.scrollTop+=R-f.current,u.scroll},[P]),a("div",{className:"dm-container",children:[a("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{c&&c.cb?(c.cb(),t(null)):d("dmList")}}),a("div",{className:"profile",onClick:u=>{u.stopPropagation(),t({cb:()=>{p(v),d("dm")}}),i.fetchAndSetProfile(v.username)},children:[e("div",{className:"avatar",children:e("img",{src:i.getAvatar(v.avatar)})}),a("div",{className:"username",children:[v.name??v.username,v.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:o,children:e("div",{className:"dm-body",children:P.map((u,R)=>{var $;let V,h=R===0,W=u.sender===g.username?"self":"other",y=(($=P[R+1])==null?void 0:$.sender)===g.username?"self":"other";return P[R+1]?V=Math.abs(u.timestamp-P[R+1].timestamp)/36e5:y=void 0,a("div",{className:`message ${W}`,id:h?"last":"",children:[W=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${W!==y?"show":"hide"}`,onClick:q=>{q.stopPropagation(),t({cb:()=>{p(v),d("dm")}}),i.fetchAndSetProfile(v.username)},children:e("img",{src:i.getAvatar(v.avatar)})}),a("div",{className:"message-content",children:[u.content&&e("div",{className:"content",children:pe(u.content)}),u.attachments&&e("div",{className:"attatchments",children:u.attachments.map((q,k)=>oe(q)?e("video",{src:q,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:H=>{Y.FullscreenImage.set({display:!0,image:q})}},k):e(ye,{src:q,onClick:()=>{Y.FullscreenImage.set({display:!0,image:q})}},k))})]})]}):a(j,{children:[u.content&&e("div",{className:"content",children:pe(u.content)}),u.attachments&&e("div",{className:"attatchments",children:u.attachments.map((q,k)=>oe(q)?e("video",{src:q,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:H=>{Y.FullscreenImage.set({display:!0,image:q})}},k):e("img",{src:q,onClick:()=>{Y.FullscreenImage.set({display:!0,image:q})}},k))})]}),P[R+1]&&V>6?e("div",{className:"date",children:Ve(u.timestamp)}):W!==y&&e("div",{className:"date",children:Ve(u.timestamp)})]},R)})})}),e("div",{className:"attachments",children:S.attachments.map((u,R)=>a("div",{className:"attachment",children:[oe(u)?e("video",{src:u,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(ye,{src:u}),e(ge,{onClick:()=>{O({...S,attachments:S.attachments.filter((V,h)=>h!==R)})}})]},R))}),a("div",{className:"dm-footer",children:[e(le,{type:"text",ref:w,onChange:u=>{O({...S,content:u.target.value})},onKeyDown:u=>{u.key==="Enter"&&U()},placeholder:n("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),S.content.length>0?e("span",{onClick:()=>U(),className:"send",children:n("APPS.INSTAGRAM.SEND")}):e(lt,{onClick:()=>{var u,R,V;S.attachments.length<3&&Y.Gallery.set({includeVideos:!0,allowExternal:(V=(R=(u=he)==null?void 0:u.value)==null?void 0:R.AllowExternal)==null?void 0:V.InstaPic,onSelect:h=>O({...S,attachments:[...S.attachments,h.src]})})}})]})]})}function Vt(){const{View:i,Func:r,Dm:C,Account:l,GoBack:A}=s.useContext(K),[g,m]=i,[d]=l,[v,p]=C,[c,t]=A,[P,E]=s.useState(!1),[w,f]=s.useState(""),[S,O]=s.useState(""),[L,M]=s.useState([]);s.useState([]);const[b,x]=s.useState([]),[I,G]=s.useState(0),[U,o]=s.useState(!1),[u,R]=s.useState(!1);s.useEffect(()=>{N("Instagram",{action:"getRecentMessages",page:0},X.messages).then(h=>{h&&x(h)})},[]);const V=()=>{if(U||u)return;let h=document.querySelector("#last");if(!h)return;!de(h)&&(R(!0),N("Instagram",{action:"getRecentMessages",page:I+1},null).then(y=>{y&&y.length>0?(x([...b,...y]),R(!1)):o(!0)}),G(y=>y+1))};return s.useEffect(()=>{const h=setTimeout(()=>f(S),500);return()=>clearTimeout(h)},[S]),s.useEffect(()=>{w.length>0?P?N("Instagram",{action:"search",query:w},X.messages.filter(h=>h.username!==d.username)).then(h=>{h&&M(h)}):M(b.filter(h=>{var W;return h.username.includes(w)||((W=h==null?void 0:h.name)==null?void 0:W.includes(w))&&h.username!==d.username})):M([])},[w]),s.useEffect(()=>{f(""),M([])},[P]),e("div",{className:"dm-list",children:P?a("div",{className:"slide up",children:[a("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{E(!1),M([])}}),e("div",{className:"title",children:n("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),a("div",{className:"dm-list-body ",children:[a("div",{className:"input",children:[e("span",{children:n("APPS.INSTAGRAM.TO")}),e(le,{type:"text",onChange:h=>O(h.target.value),placeholder:n("SEARCH")})]}),L.length>0&&e("div",{className:"items",children:L.map((h,W)=>a("div",{className:"item",onClick:()=>{E(!1),p(h),m("dm")},children:[e("div",{className:"avatar",onClick:y=>{y.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),r.fetchAndSetProfile(h.username)},children:e("img",{src:r.getAvatar(h.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[h.username,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:h.name})]})]},W))})]})]}):a(j,{children:[a("div",{className:"dm-list-header",children:[a("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>m("feed")}),e("i",{className:"far fa-edit",onClick:()=>E(!0)})]}),e(Oe,{placeholder:n("SEARCH"),onChange:h=>O(h.target.value)})]}),e("div",{className:"dm-list-body",onScroll:V,children:e("div",{className:"items",children:w.length>0&&!P?L.map((h,W)=>{var y;return((y=h.content)==null?void 0:y.length)===0&&(h.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",onClick:()=>{E(!1),p(h),m("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),r.fetchAndSetProfile(h.username)},children:e("img",{src:r.getAvatar(h.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[h.name,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),a("div",{className:"last-message",children:[h.content.length>40?h.content.substring(0,40)+"...":h.content,"  ",fe(h.timestamp)]})]})]},W)}):b.map((h,W)=>{let y=W===b.length-1;return h.content.length===0&&(h.content=n("APPS.INSTAGRAM.SENT_A_PHOTO")),a("div",{className:"item",id:y?"last":"",onClick:()=>{E(!1),p(h),m("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),r.fetchAndSetProfile(h.username)},children:e("img",{src:r.getAvatar(h.avatar)})}),a("div",{className:"info",children:[a("div",{className:"username",children:[h.name,h.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),h.content.length>40?h.content.substring(0,40)+"...":h.content,"  ",fe(h.timestamp)]})]},W)})})})]})})}function _t(){var R,V,h,W;const{Account:i,View:r,Func:C,Stories:l,Story:A,Dm:g}=s.useContext(K),[m]=i,[d,v]=r,[p,c]=l,[t,P]=A,[E,w]=g,[f,S]=s.useState(0),[O,L]=s.useState(""),[M,b]=s.useState(!1),[x,I]=s.useState({x:0,y:0});s.useEffect(()=>{if(t){I(t.origin);for(let y=0;y<t.media.length;y++)if(!t.media[y].seen)return S(y)}},[]);const G=y=>{if(M)return b(!1);const $=y.target.getBoundingClientRect(),q=y.clientX-$.left*Ne();let k=t.media[f];if(k.seen||N("Instagram",{action:"viewedStory",id:k.id}),q<$.width*Ne()/2)if(f>0)S(f-1);else{let H=p.findIndex(re=>re.username===t.username),z=p[H-1];z&&C.fetchAndSetStory(z)}else if(f<t.media.length-1)S(f+1);else{let H=p.findIndex(re=>re.username===t.username),z=p[H+1];z?(o(t.username),C.fetchAndSetStory(z),S(0)):u()}},U=()=>{!O||O===""||N("Instagram",{action:"sendMessage",username:t.username,message:{content:O}}).then(y=>{y&&(w({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),v("dm"),u())})},o=y=>{t.media.length===f+1&&c($=>$.map(q=>(q.username===y&&(q.seen=1),q)))},u=y=>{y!==!1&&o(t.username),P(null)};return a(Ee.div,{className:"instagram-story",initial:{scale:0,transformOrigin:t!=null&&t.origin?`${((R=t==null?void 0:t.origin)==null?void 0:R.x)??0}px ${((V=t==null?void 0:t.origin)==null?void 0:V.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:t!=null&&t.origin?`${((h=t==null?void 0:t.origin)==null?void 0:h.x)??0}px ${((W=t==null?void 0:t.origin)==null?void 0:W.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:x?`${(x==null?void 0:x.x)??0}px ${(x==null?void 0:x.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[oe(t==null?void 0:t.media[f].image)?e("video",{className:"background-image",onClick:G,autoPlay:!0,loop:!0,src:t==null?void 0:t.media[f].image}):e("div",{className:"background-image",onClick:G,style:{backgroundImage:`url(${t==null?void 0:t.media[f].image})`}}),e(Ie,{children:M&&e(Ft,{activeImage:f,close:()=>b(!1)})}),a("div",{className:"story-wrapper",children:[a("div",{className:"story-header",children:[e("div",{className:"story-steps",children:t==null?void 0:t.media.map((y,$)=>e("div",{className:f===$?"active":"",onClick:()=>S($)},$))}),a("div",{className:"profile-details",children:[a("div",{className:"profile",onClick:()=>{t!=null&&t.media[f].seen||N("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[f].id},!0).then(()=>u()),u(),C.fetchAndSetProfile(t.username)},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${C.getAvatar(t==null?void 0:t.avatar)})`}}),a("div",{className:"name",children:[t==null?void 0:t.username,!1]}),e("div",{className:"time",children:fe(t==null?void 0:t.media[f].timestamp)})]}),e("div",{className:"stats",children:e(ge,{onClick:()=>{if(t!=null&&t.media[f].seen)return u();N("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[f].id},!0).then(()=>u())}})})]})]}),(t==null?void 0:t.username)===m.username?a("div",{className:"story-footer","data-stats":!0,children:[a("div",{className:"seen-by",onClick:()=>b(!0),children:[(t==null?void 0:t.media[f].viewers)&&e("div",{className:"images",children:t==null?void 0:t.media[f].viewers.map((y,$)=>e("img",{src:C.getAvatar(y.avatar)},$))}),n("APPS.INSTAGRAM.SEEN_BY").format({count:Pt(t==null?void 0:t.media[f].views)??0})]}),e(ge,{onClick:()=>{Y.PopUp.set({title:n("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:n("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:n("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:n("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"removeFromStory",id:t==null?void 0:t.media[f].id},!0).then(y=>{if(!y)return _("error","Failed to remove image from story");_("info","Removed image from story"),P(null),t.media.length===1&&c($=>$.filter(q=>q.username!==t.username))})}}]})}})]}):a("div",{className:"story-footer",children:[e("div",{className:"input",children:e(le,{type:"text",placeholder:n("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:y=>L(y.target.value),onKeyDown:y=>{y.key==="Enter"&&U()}})}),e(We,{onClick:()=>U()})]})]})]})}const Ft=i=>{var w;const{Func:r,Story:C}=s.useContext(K),[l,A]=C,[g,m]=s.useState([]),[d,v]=s.useState(0),[p,c]=s.useState(!1),[t,P]=s.useState(!1);s.useEffect(()=>{var f,S;(i==null?void 0:i.activeImage)!==void 0&&N("Instagram",{action:"getViewers",id:l==null?void 0:l.media[i.activeImage].id,page:0},(S=(f=X.stories.find(O=>O.username===l.username))==null?void 0:f.media.find(O=>O.id===l.media[i.activeImage].id))==null?void 0:S.viewers).then(O=>{if(!O)return _("warning","Failed to fetch viewers data");m(O),O.length<15&&c(!0)})},[]);const E=f=>{if(p||t)return;let S=document.querySelector("#last");if(!S)return;!de(S)&&(P(!0),N("Instagram",{action:"getViewers",id:l==null?void 0:l.media[i.activeImage].id,page:d+1},null).then(L=>{L&&L.length>0?(m(M=>[...M,...L]),P(!1),L.length<15&&c(!0)):c(!0)}),v(L=>L+1))};return a(Ee.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[a("div",{className:"story-modal-header",children:[a("div",{className:"views",children:[e(ot,{})," ",e("div",{className:"views",children:((w=l==null?void 0:l.media[i==null?void 0:i.activeImage])==null?void 0:w.views)??0})]}),e(ge,{className:"close",onClick:i==null?void 0:i.close})]}),a("div",{className:"story-modal-content",children:[e("div",{className:"title",children:n("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:E,children:g.map((f,S)=>{let O=S===g.length-1?"last":"";return e("div",{className:"item",id:O,children:a("div",{className:"user",onClick:()=>{r.fetchAndSetProfile(f.username),A(null)},children:[e("div",{className:"profile-picture",children:e("img",{src:r.getAvatar(f.avatar)})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[f.username,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:f.name})]})]})},S)})})]})]})};function Dt(){const{Func:i,View:r,Account:C}=s.useContext(K),[l,A]=r,[g]=C;return e("div",{className:"instagram-footer",children:a(j,{children:[[{value:"feed",activeIcon:e(dt,{}),icon:e(mt,{})},{value:"search",activeIcon:e(ut,{}),icon:e(ft,{})},{value:"newPost",activeIcon:e(ht,{}),icon:e(gt,{})},{value:"notifications",activeIcon:e(Le,{}),icon:e(Ue,{})}].map((d,v)=>e("div",{onClick:()=>A(d.value),children:l===d.value?d.activeIcon:d.icon},v)),e("img",{src:i.getAvatar(g.avatar),className:"profile",alt:"profile",onClick:()=>i.fetchAndSetProfile(g.username)})]})})}function Ut(){const{UserPanel:i}=s.useContext(K),[r,C]=i,[l,A]=s.useState([]),[g,m]=s.useState(0),[d,v]=s.useState(!1),[p,c]=s.useState(!1);let t={[n("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[n("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[n("APPS.INSTAGRAM.LIKED_BY")]:"getLikes"};const P=(w,f)=>{var S,O;if(w!==n("APPS.INSTAGRAM.LIKED_BY")){let L=w===n("APPS.INSTAGRAM.FOLLOWING")?(S=X.accounts[f])==null?void 0:S.followingList:((O=X.accounts[f])==null?void 0:O.followerList)??[];return L==null?void 0:L.map(M=>X.accounts[M])}};s.useEffect(()=>{N("Instagram",{action:t[r.data.title],data:{postId:r.data.postId,username:r.data.username,page:0}},P(r.data.title,r.data.username)).then(w=>{if(!w)return _("info","No data returned from instagram event");A(w)})},[]);const E=()=>{if(d||p)return;!de(document.querySelector("#last"))&&(c(!0),N("Instagram",{action:t[r.data.title],data:{postId:r.data.postId,username:r.data.username,page:g+1}},null).then(f=>{f&&f.length>0?(A([...l,...f]),c(!1)):v(!0)}),m(f=>f+1))};return e(j,{children:r.data&&l&&a("div",{className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{var w;return(w=r.data)==null?void 0:w.cb()}}),e("div",{className:"userpanel-title",children:r.data.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:E,children:e("div",{className:"items",children:l.map((w,f)=>{let S=f===l.length-1;return e(xt,{data:w,allData:r.data,last:S},f)})})})]})})}const xt=i=>{const{Func:r,Account:C,GoBack:l,UserPanel:A}=s.useContext(K),[g]=C,[m,d]=l,[v,p]=A;let c=i.data,t=i.last;const[P,E]=s.useState(c.isFollowing===1);return a("div",{className:"item",id:t?"last":"",onClick:()=>{d({cb:()=>{p({display:!0,data:i.allData})}}),r.fetchAndSetProfile(c.username)},children:[a("div",{className:"user",children:[e("div",{className:"profile-picture",children:e("img",{src:r.getAvatar(c.avatar),alt:"profile"})}),a("div",{className:"user-details",children:[a("div",{className:"username",children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:c.name})]})]}),g.username!==c.username&&e("div",{className:"action",onClick:w=>{w.stopPropagation(),c.username!==g.username&&(P?Y.PopUp.set({title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:c.username}),buttons:[{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:n("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N("Instagram",{action:"toggleFollow",data:{username:c.username,following:!P}},!0).then(()=>{E(f=>!f)})}}]}):N("Instagram",{action:"toggleFollow",data:{username:c.username,following:!P}},!0).then(()=>{E(f=>!f)}))},children:P?e("div",{className:"button following",children:n("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:n("APPS.INSTAGRAM.FOLLOW")})})]})},K=s.createContext(null);function Bt(){var q;const i=ae(ue.Settings),r=(q=ae(He))==null?void 0:q.active,C=ae(ue.Styles.TextColor),[l,A]=s.useState("feed"),[g,m]=s.useState(null),[d,v]=s.useState(!1),[p,c]=s.useState([]),[t,P]=s.useState(null),[E,w]=s.useState(null),[f,S]=s.useState(null),[O,L]=s.useState(null),[M,b]=s.useState(null),[x,I]=s.useState(null),[G,U]=s.useState({display:!1,data:null}),[o,u]=s.useState(!0);s.useEffect(()=>{var k,H;r&&((k=r==null?void 0:r.data)==null?void 0:k.view)==="profile"&&V((H=r==null?void 0:r.data)==null?void 0:H.username)},[r]),s.useEffect(()=>{N("isAdmin",null,!1).then(k=>{if(ie.APPS.INSTAGRAM.account.value){m({...ie.APPS.INSTAGRAM.account.value,isAdmin:k}),v(!0),u(!1);return}else if(ie.APPS.INSTAGRAM.account.value===!1)return u(!1);N("Instagram",{action:"isLoggedIn"},X.account).then(H=>{H?(ie.APPS.INSTAGRAM.account.set(H),m({...H,isAdmin:k}),v(!0),u(!1)):(u(!1),ie.APPS.INSTAGRAM.account.set(null))})})},[]),s.useEffect(()=>{if(xe("Instagram"))return setTimeout(()=>{l==="live"||l==="story"?(ue.Styles.TextColor.set("#fafafaed"),l=="live"&&Y.IndicatorVisible.set(!1)):(ue.Styles.TextColor.set(i.display.theme==="dark"?"#fafafaed":"#000000"),Y.IndicatorVisible.set(!0)),l==="dm"?Ae.ReceiveAppNotifications.set(!1):Ae.ReceiveAppNotifications.set(!0)},250),()=>{Ae.ReceiveAppNotifications.set(!0)}},[l]);const R=(k,H)=>{k&&N("Instagram",{action:"getPost",id:k},X.posts.find(z=>z.id===k)).then(z=>{if(z){if(H)return h(z);b(z),A("post")}})},V=k=>{var H;k&&N("Instagram",{action:"getProfile",username:k},(H=X.accounts)==null?void 0:H[k]).then(z=>{if(!z)return _("warning","Failed to fetch profile data");w(z),A("profile")})},h=k=>{k.id&&N("Instagram",{action:"getComments",postId:k.id,page:0},X.comments.filter(H=>H.postId===k.id)).then(H=>{H&&(L({post:k,comments:H}),A("comments"))})},W=(k,H,z)=>{var re;!k&&!(k!=null&&k.username)||((H==null?void 0:H.length)==0&&(H=void 0),N("Instagram",{action:"getStory",username:k.username},(re=X.stories.find(me=>me.username===k.username))==null?void 0:re.media).then(me=>{if(!me)return _("warning","Failed to fetch story data");P({username:k.username,avatar:k.avatar,verified:k.verified,media:me,queue:H,origin:z})}))},y=k=>k||`./assets/img/avatar-placeholder-${i.display.theme}.svg`,$={feed:e(Et,{}),search:e(Lt,{}),notifications:e(Ct,{}),profile:e(Rt,{}),live:e(At,{}),logIn:e(_e,{}),comments:e(Ot,{}),post:e(kt,{}),newPost:e(bt,{}),userpanel:e(Ut,{}),dmList:e(Vt,{}),dm:e(yt,{})};return s.useEffect(()=>{G.display&&A("userpanel")},[G]),te("instagram:logout",k=>{if(!k)return _("warning","No username provided to logout");if(!d)return _("info","User is not logged in, cannot log out");if(k!==(g==null?void 0:g.username))return _("warning","Username provided does not match current logged in username, not logging out");m(null),v(!1),A("logIn")}),e("div",{className:"instagram-container",children:e(K.Provider,{value:{View:[l,A],Account:[g,m],Profile:[E,w],Post:[M,b],Comments:[O,L],LoggedIn:[d,v],GoBack:[x,I],UserPanel:[G,U],Dm:[f,S],Stories:[p,c],Story:[t,P],Func:{fetchAndSetProfile:V,fetchAndSetStory:W,fetchAndSetComments:h,fetchAndSetPost:R,getAvatar:y}},children:o||i.airplaneMode?e("div",{className:"loading",children:e(vt,{size:40,lineWeight:5,speed:2,color:C})}):e("div",{className:"instagram-wrapper",children:d?a(j,{children:[e(Ie,{children:t&&e(_t,{})}),$[l],l!=="live"&&l!=="logIn"&&l!=="newPost"&&l!=="comments"&&!t&&e(Dt,{})]}):e(_e,{})})})})}export{K as InstagramContext,Bt as default};
