import{u as p,j as n,m as y,S as W,a as e,L as l,F as L,x as M,f as D,ab as R,r as u,t as F,b as O,P as _,I as $,d as k,C as B,q as m,p as T,bm as j,aJ as H,s as b,K as V,E as X,_ as x,N as z,H as U,A as G}from"./index-a5f9a2c2.js";function Y(){const f=p(O),o=p(_.Settings),c=p(E),g=({amount:r})=>{const[i,A]=u.useState(!0);let s;return i&&(o!=null&&o.streamerMode)?s=parseInt("⁎".repeat(F(r,2).toString().length)).toLocaleString():s=F(r,2).toLocaleString(),s.length>15&&(s=s.slice(0,15)+"..."),e("div",{className:"value",onClick:()=>A(!i),children:f.CurrencyFormat.replace("%s",s)})};return n(y.div,{...W("left","home",.2),className:"overview",children:[e("div",{className:"wallet-header",children:e("div",{className:"title",children:l("APPS.WALLET.TITLE")})}),n("div",{className:"wrapper",children:[e("div",{className:"card"}),e("section",{children:n("div",{className:"item space",children:[n("div",{className:"balance",children:[e("div",{className:"title",children:l("APPS.WALLET.BALANCE")}),e(g,{amount:c.balance})]}),e("div",{className:"button",onClick:()=>P.set("newpayment"),children:l("APPS.WALLET.SEND")})]})}),c.recentTransactions&&c.recentTransactions.length>0&&n(L,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:l("APPS.WALLET.LATEST_TRANSACTIONS")}),n("div",{className:"link",onClick:()=>P.set("transactions"),children:[l("APPS.WALLET.ALL_TRANSACTIONS")," ",e(M,{})]})]}),e("section",{children:c.recentTransactions.slice(0,5).map((r,i)=>{let A=r.amount>0,s=r.company.match(/\d{10}/);return n("div",{className:"item multi",children:[r.logo?e("img",{src:r.logo}):!s&&e("div",{className:"image",children:r.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-details",children:[e("div",{className:"title",children:s?D(r.company):r.company}),e("div",{className:"date",children:R(r.timestamp)})]}),n("div",{className:`amount ${A?"green":"red"}`,children:[!A&&"-",f.CurrencyFormat.replace("%s",Math.abs(r.amount).toLocaleString())]})]})]},i)})})]}),c.bills&&c.bills.length>0&&n(L,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:l("APPS.WALLET.LATEST_BILLS")}),n("div",{className:"link",children:["All Bills ",e(M,{})]})]}),e("section",{})]})]})]})}function q(){const f=p(_.Settings),o=p(O),c=p(E),[g,r]=u.useState(""),[i,A]=u.useState(0),[s,v]=u.useState(""),[w,C]=u.useState(!1),d=t=>(m("info",`Can afford? ${c.balance>=t} Balance: ${c.balance}, amount: ${t}`),c.balance>=t);u.useEffect(()=>{i===0?C(s.length>3):i===1&&C(s.length>0&&d(parseFloat(s))&&parseFloat(s)<=(o.MaxTransferAmount??Number.MAX_SAFE_INTEGER))},[s]);const S=t=>{if(t=="backspace")return v(h=>h.length>0?h.slice(0,-1):"0");v(h=>h+t)};u.useEffect(()=>{if(i!==1||s.length>=9)return;const t=document.getElementById("number");t.style.width=`${s.length}ch`},[s]);const a=t=>{B.PopUp.set({title:l(`APPS.WALLET.${t}.TITLE`),description:l(`APPS.WALLET.${t}.DESCRIPTION`),buttons:[{title:l("APPS.WALLET.OK")}]})},N=()=>{if(w){if(i==0)T("Wallet",{action:"doesNumberExist",number:s},!0).then(t=>{if(!t)return a("NUMBER_DOES_NOT_EXIST");r(s),A(h=>h+1),v("")});else if(i==1){if(!d(parseFloat(s)))return a("INSUFFICIENT_FUNDS");if(parseFloat(s)>(o.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return a("Max transfer amount reached");if(f.airplaneMode)return a("AIRPLANE_MODE");T("Wallet",{action:"sendPayment",number:g,amount:Math.floor(parseFloat(s))},{success:!0}).then(t=>{t!=null&&t.success?A(h=>h+1):(m("warning","Could not send payment",t.reason),a(t.reason))})}}};return n(y.div,{...W("right","sendpayment",.25),className:"send-container",children:[n("div",{className:"send-header",children:[e("div",{onClick:()=>P.set("home"),children:i!==2&&n(L,{children:[e($,{}),l("APPS.WALLET.HOME")]})}),i===2?e("div",{onClick:()=>P.set("home"),children:l("APPS.WALLET.DONE")}):e("div",{className:!w&&"disabled",onClick:N,children:l("APPS.WALLET.NEXT")})]}),n(y.div,{...W(i!==0?"right":null,i.toString(),.25),className:"send-wrapper",children:[i===0&&n(L,{children:[e("div",{className:"user",children:e(k,{className:"number_input",type:"number",onChange:t=>v(t.target.value.replace(/[^0-9]/g,"")),value:s,placeholder:D("1234567890")})}),e("div",{className:"button",onClick:()=>{B.ContactSelector.set({onSelect:t=>{if(!(t!=null&&t.number))return m("warning","No contact found");T("Wallet",{action:"doesNumberExist",number:t.number}).then(h=>{h?(r(t.number),A(1),v("")):setTimeout(()=>a("NUMBER_DOES_NOT_EXIST"),250)})}})},children:l("APPS.WALLET.SELECT_CONTACT")}),e("div",{className:"description",children:l("APPS.WALLET.NO_REFUNDS")})]}),i===1&&n(L,{children:[n("div",{className:"amount",children:[e("div",{className:"symbol",children:o.CurrencyFormat.replace("%s","")}),e(k,{type:"number",id:"number",value:s,onChange:t=>v(t.target.value.replace(/[^0-9]/g,""))})]}),n("div",{className:"description",children:[l("APPS.WALLET.NEW_BALANCE"),": ",o.CurrencyFormat.replace("%s",""),isNaN(F(c.balance-parseFloat(s),2))?c.balance:F(c.balance-parseFloat(s),2)]})]}),i===2&&n("div",{className:"success",children:[e(j,{}),e("div",{className:"title",children:l("APPS.WALLET.DONE")}),e("div",{className:"subtitle",children:l("APPS.WALLET.DONE_SUBTITLE").format({amount:o.CurrencyFormat.replace("%s",s),number:D(g)})})]})]}),i!==2&&e("div",{className:"numpad-wrapper",children:e(H,{cb:t=>S(t)})})]})}const I={balance:10230,transactions:[{amount:-99,company:"LB",logo:"https://docs.lbscripts.com/images/icons/icon.png",timestamp:Date.now()-1e3*60*60*2},{amount:-24.45,company:"Burgershot",logo:"https://ih0.redbubble.net/image.5360028329.7056/raf,360x360,075,t,fafafa:ca443f4786.jpg",timestamp:Date.now()-1e3*60*60*6},{amount:10,company:"Breze",timestamp:Date.now()-1e3*60*60*12},{amount:-22,company:"Breze",timestamp:Date.now()-1e3*60*60*24},{amount:-99,company:"Breze",timestamp:Date.now()-1e3*60*60*24*2},{amount:3400,company:"Salary",timestamp:Date.now()-1e3*60*60*24*4},{amount:-700,company:"Invoice #1234",timestamp:Date.now()-1e3*60*60*24*4}],bills:[]};function K(){const f=p(O),o=p(b.APPS.WALLET.transactions),[c,g]=u.useState({}),[r,i]=u.useState(0),[A,s]=u.useState(!1),[v,w]=u.useState(!1);u.useEffect(()=>{if(o.length>10)return m("info","Cache exists and is a lot of shit, nto fetching getTransations");T("Wallet",{action:"getTransactions"},I.transactions).then(d=>{if(!d)return m("warning","Failed to fetch transactions");b.APPS.WALLET.transactions.set(d)})},[]);const C=()=>{if(v||A)return m("warning","Already fetched everything or is fetching");let d=document.querySelector("#last");if(!d)return m("warning","No last element");!V(d)&&(s(!0),T("Wallet",{action:"getTransactions",page:r+1},null).then(a=>{if(!a)return m("warning","Failed to fetch transactions");a&&(a==null?void 0:a.length)>0?b.APPS.WALLET.transactions.set(a):(m("info","Fetched everything"),s(!1),w(!0))}),i(a=>a+1))};return u.useEffect(()=>{if(!o)return;const d=o.reduce((S,a)=>{let N=new Date(a.timestamp).toDateString(),t=N.split(" ").slice(1,3).join(" ");return N===new Date().toDateString()?t=l("APPS.WALLET.TODAY"):N===new Date(new Date().setDate(new Date().getDate()-1)).toDateString()&&(t=l("APPS.WALLET.YESTERDAY")),S[t]||(S[t]=[]),S[t].push(a),S},{});g(d)},[o]),n(y.div,{className:"overview",...W("right","transactions",.2),children:[n("div",{className:"wallet-header",children:[n("div",{className:"navigation",onClick:()=>P.set("home"),children:[e($,{}),l("APPS.WALLET.HOME")]}),e("div",{className:"title",children:l("APPS.WALLET.TRANSACTIONS")})]}),e("div",{className:"wrapper",onScroll:C,children:Object.keys(c).map((d,S)=>n(u.Fragment,{children:[n("div",{className:"subtitle",children:[e("div",{className:"title",children:d}),e("div",{className:"value",children:n(L,{children:[c[d].reduce((a,N)=>a+N.amount,0)>0?"+":"-",f.CurrencyFormat.replace("%s",Math.abs(c[d].reduce((a,N)=>a+N.amount,0)).toLocaleString())]})})]}),e("section",{children:c[d].map((a,N)=>{let t=a.amount>0,h=a.company.match(/\d{10}/);return n("div",{className:"item multi",children:[a.logo?e("img",{src:a.logo}):!h&&e("div",{className:"image",children:a.company[0]}),n("div",{className:"info",children:[n("div",{className:"transaction-details",children:[e("div",{className:"title",children:h?D(a.company):a.company}),e("div",{className:"date",children:R(a.timestamp)})]}),n("div",{className:`amount ${t?"green":"red"}`,children:[!t&&"-",f.CurrencyFormat.replace("%s",Math.abs(a.amount).toLocaleString())]})]})]},N)})})]},S))})]})}const P=U("home"),E=U({balance:0,recentTransactions:[],bills:[]}),J={home:e(Y,{}),transactions:e(K,{}),newpayment:e(q,{})};function Z(){const f=p(_.Settings),o=p(E),c=p(P),g=p(G);return u.useEffect(()=>{var r;X("Wallet")&&(T("Wallet",{action:"getBalance"},I.balance).then(i=>{if(!i)return m("warning","Failed to fetch balance");E.patch({balance:i})}),((r=b.APPS.WALLET.transactions)==null?void 0:r.value.length)===0&&T("Wallet",{action:"getTransactions",recent:!0},I.transactions.slice(0,5)).then(i=>{if(!i)return m("warning","Failed to fetch transactions");E.patch({recentTransactions:i})}))},[g==null?void 0:g.active]),x("wallet:addTransaction",r=>{if(f.airplaneMode)return m("warning","Cannot add transaction in airplane mode");m("info","Adding transaction",r);let i={...r,timestamp:new Date().getTime()};b.APPS.WALLET.transactions.set([i,...o.recentTransactions]),E.patch({recentTransactions:[i,...o.recentTransactions].slice(0,5)})}),x("wallet:setBalance",r=>{if(f.airplaneMode)return m("warning","Cannot add transaction in airplane mode");if(!r)return m("warning","Failed to fetch balance");m("info","Setting balance",r),E.patch({balance:r})}),e("div",{className:"wallet-app-container",children:e(z,{children:J[c]})})}export{P as View,E as WalletInfo,Z as default};
